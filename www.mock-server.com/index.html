<!DOCTYPE html>
<html>
<head>
<title>MockServer</title>
<link rel="author" href="https://plus.google.com/u/0/110954472544793839756">
<link rel="apple-touch-icon-precomposed" href="apple-touch-icon.png"/>
<link rel="shortcut icon" href="apple-touch-icon.png">
<link rel="canonical" href="http://www.mock-server.com/index.html"/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="QIzvnb0rY1MnkLjIDI217X0RjxZCX2tWdUp1CvejoVw"/>
<meta name="msvalidate.01" content="9DBA7A5F05A6179123259382E10FB4A7"/>
<meta id="description" name="description" content="An API to easily mock any system or service you integrate with via HTTP from either Java or JavaScript.">
<meta name="title" content="Mock Server">
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="website">
<meta property="og:url" content="http://www.mock-server.com/">
<meta property="og:site_name" content="MockServer">
<meta property="og:title" content="MockServer">
<meta property="og:description" content="An API to easily mock any system or service you integrate with via HTTP or HTTPS from either Java or JavaScript.">
<link href="//fonts.googleapis.com/css?family=Averia+Sans+Libre:300normal,300italic,400normal,400italic,700normal,700italic|Amatic+SC:400normal|Belleza:400normal|Belgrano:400normal|Open+Sans:400normal|Dosis:400normal|Codystar:400normal|Concert+One:400normal|Oswald:400normal|Economica:400normal|Duru+Sans:400normal&amp;subset=all" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.3.0/pure-min.css">
<style>
body {
	color: #000;
}

/*
Add transition to containers so they can push in and out.
*/
#layout,
#menu,
.menu-link {
	-webkit-transition: all 0.2s ease-out;
	-moz-transition: all 0.2s ease-out;
	-ms-transition: all 0.2s ease-out;
	-o-transition: all 0.2s ease-out;
	transition: all 0.2s ease-out;
}

/*
This is the parent `<div>` that contains the menu and the content area.
*/
#layout {
	padding-left: 200px; /* left col width "#menu" */
	left: 0;
}

/*
The content `<div>` is where all your content goes.
*/
.content {
	margin: 0 auto;
	padding: 0 2em;
	max-width: 1350px;
	margin-bottom: 50px;
	line-height: 1.6em;
}

.header {
	margin: 0;
	color: #333;
	text-align: center;
	padding: 2.5em 2em 0;
	border-bottom: 1px solid #eee;
}

.header h1 {
	margin: 0.2em 0;
	font-weight: 300;
	font: 4em 'Averia Sans Libre', 'Helvetica Neue', Helvetica, Arial, sans-serif;
}

.header h2 {
	font-weight: 300;
	color: #ccc;
	padding: 0;
	margin-top: 0;
}

/*
The `#menu` `<div>` is the parent `<div>` that contains the `.pure-menu` that
appears on the left side of the page.

By using the combination of `position: fixed; top: 0; bottom:0;`, we can make
the menu have 100% height and be fixed on the page as the rest of it scrolls.
*/
#menu {
	margin-left: -200px; /* this should be "#menu" width */
	width: 200px;
	position: fixed;
	top: 0;
	left: 200px; /* this should be "#menu" width */
	bottom: 0;
	z-index: 1; /* so the menu or its navicon stays above all content */
	background: #191818;
	overflow-y: auto;
	-webkit-overflow-scroll: touch; /* for smooth scrolling on mobile */
}

/*
All anchors inside the menu should be styled like this.
*/
#menu a {
	color: #999;
	border: none;
	padding: 0.6em 0 0.6em 0.6em;
}

/*
Remove all background/borders, since we are applying them to #menu.
*/
#menu .pure-menu,
#menu .pure-menu ul {
	border: none;
	background: transparent;
}

/*
Add that light border to separate items into groups.
*/
#menu .pure-menu ul,
#menu .pure-menu .menu-item-divided {

}

/*
Change color of the anchor links on hover/focus.
*/
#menu .pure-menu li a:hover,
#menu .pure-menu li a:focus {
	background: #ffffff;
	color: #000;
}

/*
This styles the selected menu item `<li>`.
*/
#menu .pure-menu-selected,
#menu .pure-menu-heading {
	padding-left: 5px;
	border-bottom: 1px solid #333;
}

#menu div:not(:first-of-type) .pure-menu-selected,
#menu div:not(:first-of-type) .pure-menu-heading {
	border-top: 1px solid #333;
}

#menu div:first-of-type .pure-menu-selected:first-of-type,
#menu div:first-of-type .pure-menu-heading:first-of-type {
	margin-top: 5px;
}

#menu div:last-of-type li:last-of-type {
	margin-bottom: 25px;
}

/*
This styles a link within a selected menu item `<li>`.
*/
#menu .pure-menu-selected a {
	color: #fff;
}

/*
This styles the menu heading.
*/
#menu .pure-menu-heading {
	font: 110% 'Averia Sans Libre', 'Helvetica Neue', Helvetica, Arial, sans-serif;
	color: #ffffff;
	padding: 10px 10px;
	margin: 0;
}

/* -- Dynamic Button For Responsive Menu -------------------------------------*/

/*
The button to open/close the Menu is custom-made and not part of Pure. Here's
how it works:
*/

/*
`.menu-link` represents the responsive menu toggle that shows/hides on
small screens.
*/
.menu-link {
	display: none; /* show this only on small screens */
	top: 0;
	left: 200px; /* `#menu`'s width */
	background: #000;
	font-size: 10px; /* change this value to increase/decrease button size */
	z-index: 10;
	width: 2em;
	height: auto;
	padding: 2.2em 1.6em;
}

.menu-link:hover,
.menu-link:focus {
	background: #000;
}

.menu-link span {
	position: relative;
	display: block;
}

.menu-link span,
.menu-link span:before,
.menu-link span:after {
	background-color: #fff;
	width: 100%;
	height: 0.2em;
}

.menu-link span:before,
.menu-link span:after {
	position: absolute;
	margin-top: -0.6em;
	content: " ";
}

.menu-link span:after {
	margin-top: 0.6em;
}

a.anchor, a.anchor:hover, a.anchor:active, a.anchor:focus {
	display: block;
	margin-bottom: 10px;
	text-decoration: none;
	border: 0 none;
	outline: 0;
	cursor: default;
}

pre {
	white-space: pre;
	word-wrap: normal !important;
}

ul, ol {
	margin-left: 1%;
	padding-left: 1%;
}

.code {
	display: block;
	white-space: pre;
	overflow: auto;
	width: 95%;
	margin: 1em auto;
	padding: 1%;
	background-color: #0f0101;
	color: #F1F1F1;
	-moz-border-radius: 8px;
	-webkit-border-radius: 8px;
	-o-border-radius: 8px;
	-ms-border-radius: 8px;
	-khtml-border-radius: 8px;
	border-radius: 8px;
	font-family: Menlo, Monaco, "Courier New", monospace;
	font-size: 1em;
	border: 1px solid #888;
}

.inline {
	display: inline-block;
	white-space: pre;
	word-wrap: normal;
	overflow: auto;
	margin: 0;
}

.xml {
	color: #C9C9C9;
}

span.keyword {
	color: #5B93DA;
}

span.annotation {
	color: #bdb76b;
}

span.numeric_literal {
	color: #008dff;
}

span.final,
span.constant {
	color: #e28964;
	font-style: italic;
}

span.string_literal,
span.command_line_argument_switch {
	color: #5BA382;
}

span.this_value {
	color: #CF0808;
}

span.element {
	color: #89bdff;
	font-size: 0.9em;
}

span.attribute_name,
span.comment,
span.command_line_argument_placeholder {
	color: #9c9c9c;
	font-style: italic;
	font-size: 0.9em;
}

span.comment a {
	color: #6391c3;
	text-decoration: none;
}

span.comment.bold {
	color: gray;
}

span.javadoc_param_name {
	color: #c5c5c5;
}

span.javadoc_param_annotation {
	color: #9c9c9c;
	text-decoration: underline;
}

span.element_value {
	font-size: 1.15em;
	color: #E2642F;
}

span.attribute_value {
	color: blue;
}

.sub_title {
	margin-top: 3em;
	font-weight: bold;
}

/* -- Responsive Styles (Media Queries) ------------------------------------- */

/*
Hides the menu at `767px`, but modify this based on your app's needs.
*/
@media (max-width: 767px) {

	html {
		font-size: 75%;
	}

	.header {
		/*text-align: left;*/
	}

	.header h1 {
		font-size: 2.5em;
	}

	.header h2 {
		font-size: 1.25em;
	}

	/*
	Navigation Push styles.
	*/
	#layout {
		position: relative;
		padding-left: 0;
	}

	#layout.active {
		position: relative;
		left: 200px;
	}

	#layout.active #menu {
		left: 200px;
		width: 200px;
	}

	#menu {
		left: 0;
	}

	.menu-link {
		position: fixed;
		left: 0;
		display: block; /* show the button on small screens */
	}

	#layout.active .menu-link {
		left: 200px;
	}

	a.anchor, a.anchor:hover, a.anchor:active, a.anchor:focus {
		margin-bottom: 35px;
	}

	ul, ol {
		margin-left: 2%;
		padding-left: 2%;
	}

	.content {
		padding: 0 1.5%
	}

	.code {
		padding: 1%;
		font-size: 0.65em;
	}
}

@media (max-width: 568px) {

	ul, ol {
		margin-left: 4%;
		padding-left: 4%;
	}

	.code {
		padding: 2%;
	}
}
</style>
</head>
<body>
<div id="layout">
<!-- Menu toggle -->
<a href="#menu" id="menuLink" class="menu-link"><!-- Hamburger icon --><span></span></a>

<div id="menu">
	<div class="pure-menu pure-menu-open">
		<span class="pure-menu-heading">What?</span>
		<ul>
			<li><a href="#what-is-mockserver">What is MockServer</a></li>
			<li><a href="#why-use-mockserver">Why use MockServer</a></li>
		</ul>
	</div>
	<div class="pure-menu pure-menu-open">
		<span class="pure-menu-heading">How?</span>
		<ul>
			<li><a href="#getting-started">Getting Started</a></li>
			<li><a href="#starting-mockserver">Starting MockServer</a></li>
			<li><a href="#create-expectations">Creating Expectations</a></li>
			<li><a href="#verify-behaviour">Verifying Behaviour</a></li>
			<li><a href="#analysing-behaviour">Analysing Behaviour</a></li>
			<li><a href="#ensuring-tests-can-run-in-parallel">Running Tests In Parallel</a></li>
			<li><a href="#clear-and-reset">Clear & Reset</a></li>
			<li><a href="#debugging-issues">Debugging Issues</a></li>
			<li><a href="#requirements">Requirements</a></li>
		</ul>
	</div>
	<div class="pure-menu pure-menu-open">
		<span class="pure-menu-heading">Where?</span>
		<ul>
			<li><a href="#downloads">Downloads</a></li>
			<li><a href="#github">GitHub</a></li>
			<li><a href="#maven-central">Maven Central</a></li>
			<li><a href="#vertx-registry">Vert.X Registry</a></li>
			<li><a href="#docker">Docker</a></li>
			<li><a href="#continuous-integration">Continuous Integration</a></li>
			<li><a href="#backlog">Backlog</a></li>
		</ul>
	</div>
</div>
<div id="main">
<div class="header">
	<h1>MockServer</h1>

	<h2>Easy mocking of any system you integrate with via HTTP or HTTPS</h2>
</div>
<div class="content" itemscope itemtype="http://schema.org/Article">

<a href="https://github.com/jamesdbloom/mockserver"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork us on GitHub"></a>

<a name="what-is-mockserver" class="anchor" href="#what-is-mockserver">&nbsp;</a>

<div style="width: 100%">
    <a style="float: right; margin-top: 0; margin-right: 4%;" href="https://travis-ci.org/jamesdbloom/mockserver"><img
            src="https://github-camo.global.ssl.fastly.net/2e2b9deeda5c745f167e2cabcd787322df06688f/68747470733a2f2f7472617669732d63692e6f72672f6a616d657364626c6f6f6d2f6d6f636b7365727665722e706e673f6272616e63683d6d6173746572"
            alt="Build Status" data-canonical-src="https://travis-ci.org/jamesdbloom/mockserver.png?branch=master"
            style="max-width:100%;"></a>
    <a style="float: right; margin-top: 0; margin-right: 2%;" href="https://drone.io/github.com/jamesdbloom/mockserver"><img
            src="https://drone.io/github.com/jamesdbloom/mockserver/status.png" alt="Build Status"></a>
</div>
<h2>What is MockServer</h2>

<p>MockServer is for mocking of any system you integrate with via HTTP or HTTPS (i.e. services, web sites, etc).</p>

<p>MockServer supports:</p>
<ul>
	<li>mocking of any HTTP / HTTPS response when any request is matched (<a href="#mocking">see more below</a>)</li>
	<li>recording requests and responses to analyse how a system behaves (<a href="#proxying">see more below</a>)</li>
	<li>verifying which requests and responses have been sent as part of a test (<a href="#proxying">see more below</a>)</li>
</ul>


<p>There are currently clients written in Java and JavaScript (<a href="#clients">see more below</a>) although any language that can send JSON via HTTP can easily use the MockServer API.</p>

<a name="mocking" class="anchor" href="#mocking">&nbsp;</a>

<h3>Mocking</h3>

<p>To mock an HTTP / HTTPS interaction an expectation is setup specifying how a request should be matched and what response the MockServer should reply with when the request has been matched.</p>

<p>For example to create an expectation using <strong>Java</strong>:</p>

<pre><code class="code"><span class="keyword">new</span> MockServerClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9999</span>)
        .when(
                request()
                        .withMethod(<span class="string_literal">"POST"</span>)
                        .withPath(<span class="string_literal">"/login"</span>)
                        .withQueryStringParameters(
                                <span class="keyword">new</span> Parameter(<span class="string_literal">"returnUrl"</span>, <span class="string_literal">"/account"</span>)
                        )
                        .withCookies(
                                <span class="keyword">new</span> Cookie(<span class="string_literal">"sessionId"</span>, <span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>)
                        )
                        .withBody(<span class="string_literal">"{username: 'foo', password: 'bar'}"</span>),
                Times.exactly(<span class="numeric_literal">1</span>)
        )
        .respond(
                response()
                        .withStatusCode(<span class="numeric_literal">401</span>)
                        .withHeaders(
                                <span class="keyword">new</span> Header(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>),
                                <span class="keyword">new</span> Header(<span class="string_literal">"Cache-Control"</span>, <span class="string_literal">"public, max-age=86400"</span>)
                        )
                        .withBody(<span class="string_literal">"{ message: 'incorrect username and password combination' }"</span>)
                        .withDelay(new Delay(TimeUnit.<span class="constant">SECONDS</span>, <span class="numeric_literal">1</span>))
        );</code></pre>

<p style="margin-top: 2em;">Or to create an expectation using <strong>JavaScript</strong>:</p>

<pre><code class="code">mockServerClient(<span class="string_literal">"http://localhost:9999"</span>).mockAnyResponse({
    <span class="string_literal">"httpRequest"</span>: {
        <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
        <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
        <span class="string_literal">"queryStringParameters"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"returnUrl"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"/account"</span>]
            }
        ],
        <span class="string_literal">"cookies"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"sessionId"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>]
            }
        ],
        <span class="string_literal">"body"</span>: {
            <span class="string_literal">"type"</span>: <span class="string_literal">"EXACT"</span>
            <span class="string_literal">"value"</span>: JSON.stringify({ username: <span class="string_literal">"foo"</span>, password: <span class="string_literal">"bar"</span> })
        }
    },
    <span class="string_literal">"httpResponse"</span>: {
        <span class="string_literal">"statusCode"</span>: <span class="numeric_literal">401</span>,
        <span class="string_literal">"headers"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Content-Type"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"application/json; charset=utf-8"</span>]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Cache-Control"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"public, max-age=86400"</span>]
            }
        ],
        <span class="string_literal">"body"</span>: JSON.stringify({ message: <span class="string_literal">"incorrect username and password combination"</span> }),
        <span class="string_literal">"delay"</span>: {
            <span class="string_literal">"timeUnit"</span>: <span class="string_literal">"SECONDS"</span>,
            <span class="string_literal">"value"</span>: <span class="numeric_literal">1</span>
        }
    },
    <span class="string_literal">"times"</span>: {
        <span class="string_literal">"remainingTimes"</span>: <span class="numeric_literal">1</span>,
        <span class="string_literal">"unlimited"</span>: <span class="keyword">false</span>
    }
});
</code></pre>

<p>Requests can be matched on:</p>

<ul>
	<li><strong>url</strong> - regex or plain text</li>
	<li><strong>path</strong> - regex or plain text</li>
	<li><strong>query string</strong> - regex or plain text</li>
	<li><strong>headers</strong> - regex or plain text</li>
	<li><strong>cookies</strong> - regex or plain text</li>
	<li><strong>body</strong> - XPath, regex, plain text (exact match), or body parameters</li>
</ul>

<p>The body can be matched using plain text, an XPath expression or a regular expression, see <a href="http://saxon.sourceforge.net/saxon6.5.3/expressions.html">XPath Expression Syntax</a> for supported XPath syntax.</p>

<p>All other matching can be done using plain text or a regular expression, see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">Pattern (Java Platform SE 7)</a> for supported regular expression syntax.</p>

<p>Responses can contain:</p>

<ul>
	<li><strong>status code</strong></li>
	<li><strong>body</strong></li>
	<li><strong>headers</strong></li>
	<li><strong>cookies</strong></li>
</ul>

<p>Responses can be further controlled using:</p>

<ul>
	<li>a delay before the response is sent</li>
	<li>the number of times the response is sent (including unlimited)</li>
</ul>

<p>For more details see the section below on <a href="#create-expectations">creating expectations</a>.</p>

<a name="proxying" class="anchor" href="#proxying">&nbsp;</a>

<h3>Proxying</h3>

<p>MockServer also provides an HTTP / HTTPS proxy that can be used to record requests / responses.</p>

<p>Once requests / responses have been recorded:</p>

<ul>
	<li>They can be queried pragmatically to confirm what requests have been sent and what responses have been received.
		<ul>
			<li>This supports test assertions that confirm what requests the system-under-test has been sending during a test.</li>
		</ul>
	</li>
	<li>They can be output in JSON format to log what request the system under has sent and what responses it received.
		<ul>
			<li>This is useful for analysing an existing system prior to writing automated tests.</li>
			<li>This is also useful to simplify the creation of test setup code as the JSON output is in the MockServer expectation format.</li>
		</ul>
	</li>
	<li>They can be output in human readable Java code format that can be pasted directly into a test setup method.
		<ul>
			<li>This is useful to simplify the creation of expectations in test setup methods as the code can be easily pasted directly into a test setup method and then modified as appropriate for the needs of the test scenario.</li>
		</ul>
	</li>
</ul>

<p>For example to use the proxy to verify a request has been sent:</p>

<pre><code class="code"><span class="keyword">new</span> ProxyClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9999</span>)
        .verify(
                request()
                        .withMethod(<span class="string_literal">"POST"</span>)
                        .withPath(<span class="string_literal">"/login"</span>)
                        .withBody(<span class="string_literal">"{username: 'foo', password: 'bar'}"</span>),
                Times.exactly(<span class="numeric_literal">1</span>)
        );</code></pre>

<p>For example to use the proxy to print recorded requests and response to the log as JSON:</p>

<pre><code class="code"><span class="keyword">new</span> ProxyClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9999</span>)
        .dumpToLogAsJSON(
                request()
                        .withPath(<span class="string_literal">"/login"</span>)
        );</code></pre>

<p>This would result in entries in the <strong>mockserver_request.log</strong> file of the following format:</p>

<pre><code class="code">2014-01-11 13:08:54,225 {
    <span class="string_literal">"httpRequest"</span>: {
        <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
        <span class="string_literal">"url"</span>: <span class="string_literal">"http://localhost:2021/login"</span>,
        <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
        <span class="string_literal">"body"</span>: {
            <span class="string_literal">"type"</span>: <span class="string_literal">"EXACT"</span>,
            <span class="string_literal">"value"</span>: <span class="string_literal">"{username: 'foo', password: 'bar'}"</span>,
        },
        <span class="string_literal">"cookies"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"sid"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"05F1A3D2F2143C49727"</span> ]
            }
        ],
        <span class="string_literal">"headers"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Accept-Language"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"en-US,en;q=0.8,fa;q=0.6"</span> ]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Cookie"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"sid=05F1A3D2F2143C49727"</span> ]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Host"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"localhost:2021"</span> ]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Content-Length"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"34"</span> ]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Accept-Encoding"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"gzip,deflate,sdch"</span> ]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"User-Agent"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.63 Safari/537.36"</span> ]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Accept"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"*/*"</span> ]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Content-Type"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"text/plain"</span> ]
            }
        ]
    },
    <span class="string_literal">"httpResponse"</span>: {
        <span class="string_literal">"statusCode"</span>: <span class="numeric_literal">200</span>,
        <span class="string_literal">"body"</span>: <span class="string_literal">"{ message: 'success' }"</span>,
        <span class="string_literal">"headers"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Content-Type"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"application/json; charset=utf-8"</span> ]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Cache-Control"</span>,
                <span class="string_literal">"values"</span>: [ <span class="string_literal">"no-cache, no-store"</span> ]
            }
        ]
    },
    <span class="string_literal">"times"</span>: {
        <span class="string_literal">"remainingTimes"</span>: <span class="numeric_literal">1</span>,
        <span class="string_literal">"unlimited"</span>: <span class="keyword">false</span>
    }
}</code></pre>

<a name="versions" class="anchor" href="#versions">&nbsp;</a>

<h2>Versions</h2>

<p>MockServer is flexible and support numerous usage patterns.</p>

<p>The mock server can be run:</p>

<ul>
	<li>via the mockserver-maven-plugin, for example, as part of a build cycle</li>
	<li>programmatically via an API, for example, in an <span class="annotation">@Before</span> / <span class="annotation">@After</span> method</li>
	<li>from the command line as a stand-alone process, for example, as part of a deployment process to a test environment</li>
</ul>

<p>MockServer is available as:</p>

<ul>
	<li>a stand alone Embedded Jetty web server that is fully self contained</li>
	<li>a deployable WAR that runs on any JEE web server</li>
	<li>a Vert.X module that runs on a Vert.X</li>
</ul>

<a name="clients" class="anchor" href="#clients">&nbsp;</a>

<h2>Clients</h2>

<p>MockServer has the following clients:</p>

<p><strong>Note:</strong> It is not necessary to use the provided clients because the protocol is very simple JSON/HTTP.</p>

<ul>
	<li>Java
		<ul>
			<li><strong>org.mockserver.client.server.MockServerClient</strong> - supports:
				<ul>
					<li>creating expectations</li>
					<li>clearing expectations (selectively)</li>
					<li>resetting (clearing all expectations)</li>
					<li>dumping all expectations to the log (for debugging)</li>
				</ul>
			</li>
			<li><strong>org.mockserver.client.proxy.ProxyClient</strong> - supports:
				<ul>
					<li>verifying which requests have been recorded</li>
					<li>retrieving all recorded requests / responses as JSON or Expectation objects</li>
					<li>outputting to the log all recorded requests / responses as Expectations in JSON format</li>
					<li>outputting to the log all recorded requests / responses as Expectations in Java code format that can be pasted into test setup methods</li>
					<li>clearing recorded requests / responses (selectively)</li>
					<li>resetting (clearing all recorded requests / responses)</li>
				</ul>
			</li>
		</ul>
	</li>
	<li>JavaScript
		<ul>
			<li><strong>mockServerClient.js</strong> - supports:
				<ul>
					<li>creating expectations</li>
					<li>clearing expectations (selectively)</li>
					<li>resetting (clearing all expectations)</li>
					<li>dumping all expectations to the log (for debugging)</li>
				</ul>
			</li>
			<li><strong>proxyClient.js</strong> - supports:
				<ul>
					<li>verifying which requests have been recorded</li>
					<li>retrieving all recorded requests / responses as JSON or Expectation objects</li>
					<li>outputting to the log all recorded requests / responses as Expectations in JSON format</li>
					<li>clearing recorded requests / responses (selectively)</li>
					<li>resetting (clearing all recorded requests / responses)</li>
				</ul>
			</li>
		</ul>
	</li>
</ul>


<a name="why-use-mockserver" class="anchor" href="#why-use-mockserver">&nbsp;</a>

<h2>Why use MockServer</h2>

<p>MockServer allows you to mock any server or service that you connect to over HTTP or HTTPS, such as a REST or RPC service. </p>

<p>This is useful in the following scenarios:</p>

<ul>
	<li>testing

		<ul>
			<li>easily recreate all types of responses for HTTP dependencies such as REST or RPC services to test applications easily and affectively</li>
			<li>isolate the system under test to ensure tests run reliably and only fail when there is a genuine bug. It is important only the system under test is tested and not its dependencies to avoid tests failing due to irrelevant external changes such as network failure or a server being rebooted / redeployed.</li>
			<li>easily setup mock responses independently for each test to ensure test data is encapsulated with each test. Avoid sharing data between tests that is difficult to manage and maintain and risks tests infecting each other.</li>
		</ul>
	</li>
	<li>de-coupling development

		<ul>
			<li>start working against a service API before the service is available. If an API or service is not yet fully developed MockServer can mock the API allowing any team who is using the service to start work without being delayed.</li>
			<li>isolate development teams particularly critical during the initial development phases when the APIs / services may be extremely unstable and volatile. Using the MockServer allows development work to continue even when an external service fails.</li>
		</ul>
	</li>
</ul>

<p>A system with service dependencies as follows:</p>

<p><a href="images/SystemInProduction.png" target="_blank"><img src="images/SystemInProduction.png" alt="System In Production" style="max-width:100%;"></a></p>

<p>Could be tested with MockServer, mocking the service dependencies, as follows:</p>

<p><a href="images/SystemUnderTest.png" target="_blank"><img src="images/SystemUnderTest.png" alt="Mocking service dependencies with MockServer" style="max-width:100%;"></a></p>

<a name="getting-started" class="anchor" href="#getting-started">&nbsp;</a>

<h2>Getting Started</h2>

<p>To use the MockServer:</p>

<ol>
	<li><a href="#starting-mockserver">Start MockServer</a></li>
	<li><a href="#create-expectations">Create Expectations</a></li>
	<li><a href="#verify-behaviour">Verify Behaviour</a></li>
	<li>Run Tests</li>
</ol>

<a name="starting-mockserver" class="anchor" href="#starting-mockserver">&nbsp;</a>

<h3>Starting MockServer</h3>

<p>Before any mock expectation can be sent to the MockServer it must be started.</p>

<p>The mock server can be run:</p>

<ul>
	<li>via a <a href="#maven-plugin"><strong>Maven Plugin</strong></a> as part of a build cycle</li>
	<li><a href="#client-api"><strong>programmatically via an API</strong></a> in an <span class="annotation">@Before</span> or <span class="annotation">@After</span> method</li>
	<li><a href="#running-from-command-line"><strong>from the command line</strong></a> as a stand-alone process in a test environment</li>
	<li>as a <a href="#vertx-module"><strong>Vert.X module</strong></a> as part of an existing Vert.X environment</li>
	<li>as a <a href="#deployable-war"><strong>deployable WAR</strong></a> to an existing application server</li>
</ul>

<p>MockServer is available as:</p>

<ul>
	<li>a stand alone Embedded Jetty web server that is fully self contained</li>
	<li>a deployable WAR that runs on any JEE web server</li>
	<li>a Vert.X module that runs on a Vert.X</li>
</ul>

<p>It is also possible to build and run the MockServer directly from source code <a href="#build-and-run-from-source">as described below</a></p>

<a name="maven-plugin" class="anchor" href="#maven-plugin">&nbsp;</a>

<h4>Maven Plugin</h4>

<p>To run MockServer as part of your build add the following plugin to your pom.xml:</p>

<pre><code class="code xml">&lt;<span class="element">plugin</span>&gt;
    &lt;<span class="element">groupId</span>&gt;<span class="element_value">org.mock-server</span>&lt;/<span class="element">groupId</span>&gt;
    &lt;<span class="element">artifactId</span>&gt;<span class="element_value">mockserver-maven-plugin</span>&lt;/<span class="element">artifactId</span>&gt;
    &lt;<span class="element">version</span>&gt;<span class="element_value">2.9</span>&lt;/<span class="element">version</span>&gt;
    &lt;<span class="element">configuration</span>&gt;
        &lt;<span class="element">serverPort</span>&gt;<span class="element_value">1080</span>&lt;/<span class="element">serverPort</span>&gt;
        &lt;<span class="element">serverSecurePort</span>&gt;<span class="element_value">1082</span>&lt;/<span class="element">serverSecurePort</span>&gt;
        &lt;<span class="element">proxyPort</span>&gt;<span class="element_value">1090</span>&lt;/<span class="element">proxyPort</span>&gt;
        &lt;<span class="element">proxySecurePort</span>&gt;<span class="element_value">1092</span>&lt;/<span class="element">proxySecurePort</span>&gt;
        &lt;<span class="element">logLevel</span>&gt;<span class="element_value">DEBUG</span>&lt;/<span class="element">logLevel</span>&gt;
        &lt;<span class="element">initializationClass</span>&gt;<span class="element_value">org.mockserver.maven.ExampleInitializationClass</span>&lt;/<span class="element">initializationClass</span>&gt;
    &lt;/<span class="element">configuration</span>&gt;
    &lt;<span class="element">executions</span>&gt;
        &lt;<span class="element">execution</span>&gt;
            &lt;<span class="element">id</span>&gt;<span class="element_value">process-test-classes</span>&lt;/<span class="element">id</span>&gt;
            &lt;<span class="element">phase</span>&gt;<span class="element_value">process-test-classes</span>&lt;/<span class="element">phase</span>&gt;
            &lt;<span class="element">goals</span>&gt;
                &lt;<span class="element">goal</span>&gt;<span class="element_value">start</span>&lt;/<span class="element">goal</span>&gt;
            &lt;/<span class="element">goals</span>&gt;
        &lt;/<span class="element">execution</span>&gt;
        &lt;<span class="element">execution</span>&gt;
            &lt;<span class="element">id</span>&gt;<span class="element_value">verify</span>&lt;/<span class="element">id</span>&gt;
            &lt;<span class="element">phase</span>&gt;<span class="element_value">verify</span>&lt;/<span class="element">phase</span>&gt;
            &lt;<span class="element">goals</span>&gt;
                &lt;<span class="element">goal</span>&gt;<span class="element_value">stop</span>&lt;/<span class="element">goal</span>&gt;
            &lt;/<span class="element">goals</span>&gt;
        &lt;/<span class="element">execution</span>&gt;
    &lt;/<span class="element">executions</span>&gt;
&lt;/<span class="element">plugin</span>&gt;</code></pre>

<p>This will start the MockServer during the <strong>process-test-classes</strong> phase and will stop the MockServer during the <strong>verify</strong> phase. For more details about Maven build phases see:
	<a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">Introduction to the Build Lifecycle</a>.</p>

<p>This ensures that any integration tests you run during the <strong>test</strong> or <strong>integration-test</strong> phases can use the MockServer on the port specified.</p>

<p>It is also possible to run the MockServer as a forked JVM using the <span class="annotation">runForked</span> and <span class="annotation">stopForked</span> goals as follows:</p>

<pre><code class="code xml"> &lt;<span class="element">plugin</span>&gt;
     &lt;<span class="element">groupId</span>&gt;<span class="element_value">org.mock-server</span>&lt;/<span class="element">groupId</span>&gt;
     &lt;<span class="element">artifactId</span>&gt;<span class="element_value">mockserver-maven-plugin</span>&lt;/<span class="element">artifactId</span>&gt;
     &lt;<span class="element">version</span>&gt;<span class="element_value">2.9</span>&lt;/<span class="element">version</span>&gt;
     &lt;<span class="element">configuration</span>&gt;
        &lt;<span class="element">serverPort</span>&gt;<span class="element_value">1080</span>&lt;/<span class="element">serverPort</span>&gt;
        &lt;<span class="element">serverSecurePort</span>&gt;<span class="element_value">1082</span>&lt;/<span class="element">serverSecurePort</span>&gt;
        &lt;<span class="element">proxyPort</span>&gt;<span class="element_value">1090</span>&lt;/<span class="element">proxyPort</span>&gt;
        &lt;<span class="element">proxySecurePort</span>&gt;<span class="element_value">1092</span>&lt;/<span class="element">proxySecurePort</span>&gt;
        &lt;<span class="element">logLevel</span>&gt;<span class="element_value">DEBUG</span>&lt;/<span class="element">logLevel</span>&gt;
        &lt;<span class="element">initializationClass</span>&gt;<span class="element_value">org.mockserver.maven.ExampleInitializationClass</span>&lt;/<span class="element">initializationClass</span>&gt;
     &lt;/<span class="element">configuration</span>&gt;
     &lt;<span class="element">executions</span>&gt;
         &lt;<span class="element">execution</span>&gt;
             &lt;<span class="element">id</span>&gt;<span class="element_value">process-test-classes</span>&lt;/<span class="element">id</span>&gt;
             &lt;<span class="element">phase</span>&gt;<span class="element_value">process-test-classes</span>&lt;/<span class="element">phase</span>&gt;
             &lt;<span class="element">goals</span>&gt;
                 &lt;<span class="element">goal</span>&gt;<span class="element_value">runForked</span>&lt;/<span class="element">goal</span>&gt;
             &lt;/<span class="element">goals</span>&gt;
         &lt;/<span class="element">execution</span>&gt;
         &lt;<span class="element">execution</span>&gt;
             &lt;<span class="element">id</span>&gt;<span class="element_value">verify</span>&lt;/<span class="element">id</span>&gt;
             &lt;<span class="element">phase</span>&gt;<span class="element_value">verify</span>&lt;/<span class="element">phase</span>&gt;
             &lt;<span class="element">goals</span>&gt;
                 &lt;<span class="element">goal</span>&gt;<span class="element_value">stopForked</span>&lt;/<span class="element">goal</span>&gt;
             &lt;/<span class="element">goals</span>&gt;
         &lt;/<span class="element">execution</span>&gt;
     &lt;/<span class="element">executions</span>&gt;
 &lt;/<span class="element">plugin</span>&gt;</code></pre>

<p>
	<strong>Note:</strong> If you use the <span class="annotation">runForked</span> goal as above and the <strong>test</strong> phase fails (because a test has failed) the MockServer will not be stopped as Maven does not run any more phases after a phase has failed. In the case above the
	<strong>verify</strong> phase is not run if a test fails so the forked MockServer will not be stopped. If you want to ensure the MockServer is stopped even when there are test failures make sure you use <span class="annotation">start</span> and
	<span class="annotation">stop</span> goals as these run the MockServer on a separate thread that is stopped however maven exits (even if a test fails). </p>

<p>These goals can be used from the command line as well to start and stop MockServer, as follows:</p>

<p>To run the MockServer synchronously and block:</p>

<pre><code class="code">mvn mockserver:run</code></pre>

<p>To run the MockServer asynchronously as a forked JVM:</p>

<pre><code class="code">mvn mockserver:runForked</code></pre>

<p>To stop a forked instance of the MockServer running on the same machine:</p>

<pre><code class="code">mvn mockserver:stopForked</code></pre>

<p>The <strong>stopForked</strong> goal does assumes that the MockServer is running on the same physical machine as it uses 127.0.0.1 to communicate with the MockServer stop socket.</p>

<p>The Maven plugin has the following goals:</p>

<ul>
	<li>
		<strong>start</strong> - start MockServer, do not block, but stop when build ends
	</li>
	<li>
		<strong>stop</strong> - stop a MockServer started earlier as part of the current build
	</li>
	<li>
		<strong>run</strong> - run MockServer and block waiting for requests (timeout config if provided limits how long to block for)
	</li>
	<li>
		<strong>runForked</strong> - run MockServer as separate forked JVM, do not block, stay alive when build ends
	</li>
	<li>
		<strong>stopForked</strong> - stop a forked MockServer, previously started by a runForked goal
	</li>
</ul>
<p>The Maven plugin can be configured as follows:</p>

<ul>
	<li>
		<strong>serverPort</strong> - The port the MockServer listens to incoming HTTP requests (required: false - but at least one of the four ports must be specified)
	</li>
	<li>
		<strong>serverSecurePort</strong> - The port the MockServer listens to incoming HTTPS requests (required: false - but at least one of the four ports must be specified)
	</li>
	<li>
		<strong>proxyPort</strong> - The port the proxy listens to incoming HTTP (and HTTP -> HTTPS CONNECT) requests (required: false - but at least one of the four ports must be specified)
	</li>
	<li>
		<strong>proxySecurePort</strong> - The port the proxy listens to incoming HTTPS requests (required: false - but at least one of the four ports must be specified)
	</li>
	<li>
		<strong>timeout</strong> - How long to block waiting for MockServer, used by <strong>run</strong> goal, 0 means wait indefinitely (required: false, default: 0)
	</li>
	<li>
		<strong>logLevel</strong> - The logging level (required: false, default: WARN)
	</li>
	<li>
		<strong>skip</strong> - Prevent the plugin from running (required: false, default: false)
	</li>
	<li>
		<strong>initializationClass</strong> - To enable the creation of default expectations that are generic across all tests or mocking scenarios a class can be specified to initialize expectations in the MockServer, this class must implement <span class="annotation">org.mockserver.initialize.ExpectationInitializer</span> interface, the <span class="annotation">initializeExpectations(MockServerClient mockServerClient)</span> method will be called once the MockServer has been started (but ONLY if <strong>serverPort</strong> has been set), however it should be noted that it is generally better practice to create all expectations locally in each test (or test class) for clarity, simplicity and to avoid brittle tests.  Note: that the plugin must be started during the <strong>process-test-classes</strong> to ensure that the initialization class has been compiled from either <strong>src/main/java</strong> or <strong>src/test/java</strong> locations. (required: false, default: false)
	</li>
</ul>

<a name="client-api" class="anchor" href="#client-api">&nbsp;</a>

<h4>Client API&nbsp;&nbsp;-&nbsp;&nbsp;starting and stopping</h4>

<p>Use the client API to run the MockServes programmatically.</p>

<p>First add the following maven dependency:</p>

<pre><code class="code xml">&lt;!-- mockserver --&gt;
&lt;<span class="element">dependency</span>&gt;
     &lt;<span class="element">groupId</span>&gt;<span class="element_value">org.mock-server</span>&lt;<span class="element">/groupId</span>&gt;
     &lt;<span class="element">artifactId</span>&gt;<span class="element_value">mockserver-netty</span>&lt;<span class="element">/artifactId</span>&gt;
     &lt;<span class="element">version</span>&gt;<span class="element_value">2.9</span>&lt;<span class="element">/version</span>&gt;
&lt;<span class="element">/dependency</span>&gt;</code></pre>

<p>To start the server and create a client the simplest way is to the start factory methods ClientAndServer.startClientAndServer or ClientAndProxy.startClientAndProxy as follows:</p>


<p>Add includes:</p>

<pre><code class="code"><span class="keyword">import static</span> org.mockserver.integration.ClientAndProxy.startClientAndProxy;
<span class="keyword">import static</span> org.mockserver.integration.ClientAndServer.startClientAndServer;</code></pre>

<p>Add fields:</p>

<pre><code class="code"><span class="keyword">private</span> ClientAndProxy <span class="this_value">proxy</span>;
<span class="keyword">private</span> ClientAndServer <span class="this_value">mockServer</span>;</code></pre>

<p>Use factory method to start server and client when appropriate, for example in <span class="annotation">@Before</span> method:</p>

<pre><code class="code"><span class="annotation">@Before</span>
<span class="keyword">public void</span> startProxy() {
    <span class="this_value">mockServer</span> = startClientAndServer(<span class="numeric_literal">8080</span>);
    <span class="this_value">proxy</span> = startClientAndProxy(<span class="numeric_literal">9090</span>);
}</code></pre>

<p>Stop server and client when appropriate, for example in <span class="annotation">@After</span> method:</p>


<pre><code class="code"><span class="annotation">@After</span>
<span class="keyword">public void</span> stopProxy() {
    <span class="this_value">proxy</span>.stop();
    <span class="this_value">mockServer</span>.stop();
}</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example test called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/test/java/org/mockserver/web/controller/BooksPageIntegrationTest.java">BookPageIntegrationTest</a> that demonstrates a fully working example.</p>

<a name="running-from-command-line" class="anchor" href="#running-from-command-line">&nbsp;</a>

<h4>Running From Command Line</h4>

<p>MockServer can be run directly from the command line and using Embedded Jetty as follow:</p>

<ol>
	<li><p>download <a href="http://search.maven.org/remotecontent?filepath=org/mock-server/mockserver-netty/2.9/mockserver-netty-2.9-jar-with-dependencies.jar">mockserver-netty-2.9-jar-with-dependencies.jar</a> from Maven Central</p></li>
	<li>
		<code class="code inline">java -jar &lt;path to mockserver-netty-2.9-jar-with-dependencies.jar&gt; -serverPort &lt;port&gt;</code>
	</li>
</ol>

<p>The command line supports the following options:</p>

<pre><code class="code">java -jar &lt;path to jar&gt; [-serverPort &lt;port&gt;]        \
                        [-serverSecurePort &lt;port&gt;]  \
                        [-proxyPort &lt;port&gt;]         \
                        [-proxySecurePort &lt;port&gt;]

  valid options are:
     -serverPort &lt;port&gt;         specifies the HTTP port for the MockServer
                                if neither serverPort or serverSecurePort
                                are provide the MockServer is not started
     -serverSecurePort &lt;port&gt;   specifies the HTTPS port for the MockServer
                                if neither serverPort or serverSecurePort
                                are provide the MockServer is not started

     -proxyPort &lt;path&gt;          specifies the HTTP port for the proxy
                                if neither proxyPort or proxySecurePort
                                are provide the MockServer is not started
     -proxySecurePort &lt;path&gt;    specifies the HTTPS port for the proxy
                                if neither proxyPort or proxySecurePort
                                are provide the MockServer is not started</code></pre>

<p>For example:</p>

<pre><code class="code">java -jar ~/Downloads/mockserver-netty-2.9-jar-with-dependencies.jar -serverPort 8080 -proxyPort 9090</code></pre>

<a name="vertx-module" class="anchor" href="#vertx-module">&nbsp;</a>

<h4>Vert.X Module</h4>

<p>MockServer can be run as a Vert.X module.</p>

<p>First, you'll need to <a href="http://vertx.io/install.html">install Vert.x</a>.</p>

<p>Then to run MockServer as Vert.X module run the following command:</p>

<pre><code class="code">vertx install org.mock-server~mockserver-vertx~2.9
export VERTX_OPTS=<span class="string_literal">"-Dmockserver.serverPort=8080 -Dmockserver.serverSecurePort=1443 -Dmockserver.logLevel=TRACE"</span>
vertx runmod org.mock-server~mockserver-vertx~2.9</code></pre>

<p>The specify the HTTP port and / or HTTPS port the <strong>VERTX_OPTS</strong> environment variable must be set specifying the system property <strong>mockserver.serverPort</strong> for the HTTP port and <strong>mockserver.serverSecurePort</strong> for the HTTPS port.</p>

<p><strong>Note:</strong> At least one of either the HTTP or the HTTPS port must be specified for the MockServer to run.</p>

<pre><code class="code">export VERTX_OPTS=<span class="string_literal">"-Dmockserver.serverPort=8080 -Dmockserver.serverSecurePort=1443 -Dmockserver.logLevel=TRACE"</span></code></pre>

<p>It is also possible to update the default logging level by setting the system properties <strong>mockserver.logLevel</strong> as above.</p>

<a name="deployable-war" class="anchor" href="#deployable-war">&nbsp;</a>

<h4>Web Archive (WAR)</h4>

<p>To run as a WAR deployed on any JEE web server:</p>

<ol>
	<li>download <a href="http://search.maven.org/remotecontent?filepath=org/mock-server/mockserver-war/2.9/mockserver-war-2.9.war">mockserver-war-2.9.war</a> from Maven Central</li>
	<li>deploy <strong>mockserver-war-2.9.war</strong> to any JEE web server</li>
</ol>

<p><strong>WAR Context Path</strong></p>

<p>The WAR context path is ignored from all request matching except when matching on the full request url.</p>

<p>Therefore when setting up expectations or verifying requests it is recommended to only match on request path (and not url) when the deployed WAR has a context path to avoid a dependency between the test code and the context path.</p>

<p>The MockServerClient constructor includes an argument for the context path that the WAR has been deployed to, as follows:</p>

<pre><code class="code"><span class="keyword">public</span> MockServerClient(String host, <span class="keyword">int</span> port, String contextPath)</code></pre>

<a name="build-and-run-from-source" class="anchor" href="#build-and-run-from-source">&nbsp;</a>

<h4>Build & Run From Source</h4>

<p>MockServer is now only built using maven as the use of gradle caused problems with the Travis CI environment so the gradle build was removed.</p>

<p>First clone the repository as follows:</p>

<pre><code class="code">git clone https://github.com/jamesdbloom/mockservice.git
cd mockserver</code></pre>

<p>Next build and run the project using maven.</p>

<p><strong><em>Maven</em></strong></p>

<p>To build an executable jar containing all dependencies run the following command:</p>

<pre><code class="code">mvn clean package</code></pre>

<p>This will produce a jar file under the target directory called, as follows:</p>

<pre><code class="code">mockserver-netty/target/mockserver-netty-2.9-jar-with-dependencies.jar</code></pre>

<p>Run the MockServer then using the executable jar as per the instruction above in <a href="#running-from-command-line">Running From The Command Line</a></p>

<p><strong>Create Client For Existing MockServer or Proxy</strong></p>

<p>To create a pointing at an existing endpoint using the MockServerClient and ProxyClient constructors, for example:</p>

<pre><code class="code"><span class="annotation">@Before</span>
<span class="keyword">public void</span> startProxy() {
    <span class="this_value">mockServer</span> = <span class="keyword">new</span> MockServerClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">8080</span>);
    <span class="this_value">proxy</span> = <span class="keyword">new</span> ProxyClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9090</span>);
}</code></pre>

<p>The MockServerClient has the following methods:</p>

<pre><code class="code"><span class="comment">/**
* Start the client communicating to a MockServer at the specified host and port
* for example:
*
*   MockServerClient mockServerClient = <span class="keyword">new</span> MockServerClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">8080</span>);
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">host</span> the host for the MockServer to communicate with
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">port</span> the port for the MockServer to communicate with
*/</span>
<span class="keyword">public</span> MockServerClient(String host, <span class="keyword">int</span> port);

<span class="comment">/**
* Start the client communicating to a MockServer at the specified host and port
* and contextPath for example:
*
*   MockServerClient mockServerClient = <span class="keyword">new</span> MockServerClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">8080</span>, <span class="string_literal">"/mockserver"</span>);
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">host</span> the host for the MockServer to communicate with
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">port</span> the port for the MockServer to communicate with
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">contextPath</span> the context path that the MockServer war is deployed to
*/</span>
<span class="keyword">public</span> MockServerClient(String host, <span class="keyword">int</span> port, String contextPath);

<span class="comment">/**
* Specify an unlimited expectation that will respond regardless of the number of matching http
* for example:
*
*   <span class="this_value">mockServerClient</span>
*           .when(
*                   request()
*                           .withPath(<span class="string_literal">"/some_path"</span>)
*                           .withBody(<span class="string_literal">"some_request_body"</span>)
*           )
*           .respond(
*                   response()
*                           .withBody(<span class="string_literal">"some_response_body"</span>)
*                           .withHeaders(
*                                   new Header(<span class="string_literal">"responseName"</span>, <span class="string_literal">"responseValue"</span>)
*                           )
*           );
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that must be matched for this expectation to respond
* <span class="javadoc_param_annotation">@return</span> an Expectation object that can be used to specify the response
*/</span>
<span class="keyword">public</span> ForwardChainExpectation when(HttpRequest httpRequest);

<span class="comment">/**
* Specify an limited expectation that will respond a specified number of times when the http is matched
* for example:
*
*   <span class="this_value">mockServerClient</span>
*           .when(
*                   new HttpRequest()
*                           .withPath(<span class="string_literal">"/some_path"</span>)
*                           .withBody(<span class="string_literal">"some_request_body"</span>),
*                   Times.exactly(<span class="numeric_literal">5</span>)
*           )
*           .respond(
*                   new HttpResponse()
*                           .withBody(<span class="string_literal">"some_response_body"</span>)
*                           .withHeaders(
*                                   new Header(<span class="string_literal">"responseName"</span>, <span class="string_literal">"responseValue"</span>)
*                           )
*           );
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that must be matched for this expectation to respond
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">times</span>       the number of times to respond when this http is matched
* <span class="javadoc_param_annotation">@return</span> an Expectation object that can be used to specify the response
*/</span>
<span class="keyword">public</span> ForwardChainExpectation when(HttpRequest httpRequest, Times times);

<span class="comment">/**
* Pretty-print the json for all expectations to the log.
* They are printed into a dedicated log called <span class="annotation">mockserver_request.log</span>
*/</span>
<span class="keyword">public</span> MockServerClient dumpToLog();

<span class="comment">/**
* Pretty-print the json for all expectations that match the request to the log.
* They are printed into a dedicated log called <span class="annotation">mockserver_request.log</span>
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that is matched against when deciding what to log
*                    if <span class="keyword">null</span> all requests are logged
*/</span>
<span class="keyword">public</span> MockServerClient dumpToLog(HttpRequest httpRequest);

<span class="comment">/**
* Reset MockServer by clearing all expectations
*/</span>
<span class="keyword">public</span> MockServerClient reset();

<span class="comment">/**
* Clear all expectations that match the http
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that is matched against when deciding whether to clear each expectation
*                    if <span class="keyword">null</span> all expectations are cleared
*/</span>
<span class="keyword">public</span> MockServerClient clear(HttpRequest httpRequest);</code></pre>

<p>The ProxyClient has the following methods:</p>

<pre><code class="code"><span class="comment">/**
* Start the client communicating to the proxy at the specified host and port
* for example:
*   ProxyClient mockServerClient = <span class="keyword">new</span> ProxyClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">1080</span>);
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">host</span> the host for the proxy to communicate with
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">port</span> the port for the proxy to communicate with
*/</span>
<span class="keyword">public</span> ProxyClient(String host, <span class="keyword">int</span> port);

<span class="comment">/**
* Pretty-print the json for all requests / responses as Expectations to the log.  
* They are printed into a dedicated log called <span class="annotation">mockserver_request.log</span>
*/</span>
<span class="keyword">public</span> ProxyClient dumpToLogAsJSON();

<span class="comment">/**
* Pretty-print the json for matching requests and their responses as Expectations to the log.  
* They are printed into a dedicated log called <span class="annotation">mockserver_request.log</span>
*	
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that is matched against when deciding what to log
*                    if <span class="keyword">null</span> all requests are logged
*/</span>
<span class="keyword">public</span> ProxyClient dumpToLogAsJSON(HttpRequest httpRequest);

<span class="comment">/**
* Output Java code for creating all requests / responses as Expectations to the log.  
* They are printed into a dedicated log called <span class="annotation">mockserver_request.log</span>
*/</span>
<span class="keyword">public</span> ProxyClient dumpToLogAsJava();

<span class="comment">/**
* Output Java code for creating matching requests and their responses as Expectations to the log.  
* They are printed into a dedicated log called <span class="annotation">mockserver_request.log</span>
*	
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that is matched against when deciding what to log
*                    if <span class="keyword">null</span> all requests are logged
*/</span>
<span class="keyword">public</span> ProxyClient dumpToLogAsJava(HttpRequest httpRequest);

<span class="comment">/**
* Reset the proxy by clearing recorded requests
*/</span>
<span class="keyword">public</span> ProxyClient reset();

<span class="comment">/**
* Clear all recorded requests that match the httpRequest parameter
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that is matched against when deciding whether to clear recorded requests
*/</span>
<span class="keyword">public</span> ProxyClient clear(HttpRequest httpRequest);

<span class="comment">/**
* Verify a request has been sent for example:
*
*   <span class="this_value">mockServerClient</span>
*           .verify(
*                   request()
*                           .withPath(<span class="string_literal">"/some_path"</span>)
*                           .withBody(<span class="string_literal">"some_request_body"</span>)
*           );
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that must be matched for this verification to pass
* <span class="javadoc_param_annotation">@throws</span> <span class="javadoc_param_name">AssertionError</span> if the request has not been found
*/</span>
<span class="keyword">public</span> ProxyClient verify(HttpRequest httpRequest) <span class="keyword">throws</span> AssertionError;

<span class="comment">/**
* Verify a request has been sent for example:
*
*   <span class="this_value">mockServerClient</span>
*           .verify(
*                   request()
*                           .withPath(<span class="string_literal">"/some_path"</span>)
*                           .withBody(<span class="string_literal">"some_request_body"</span>),
*                   Times.exactly(<span class="numeric_literal">3</span>)
*           );
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that must be matched for this verification to pass
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">times</span> the number of times this request must be matched
* <span class="javadoc_param_annotation">@throws</span> <span class="javadoc_param_name">AssertionError</span> if the request has not been found
*/</span>
<span class="keyword">public</span> ProxyClient verify(HttpRequest httpRequest, Times times) <span class="keyword">throws</span> AssertionError;

<span class="comment">/**
* Retrieve the recorded requests that match the httpRequest parameter as expectations
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that is matched against when deciding whether to return each expectation,
*                    use <span class="keyword">null</span> for the parameter to retrieve for all requests
* <span class="javadoc_param_annotation">@return</span> an array of all expectations that have been recorded by the proxy
*/</span>
<span class="keyword">public</span> Expectation[] retrieveAsExpectations(HttpRequest httpRequest);

<span class="comment">/**
* Retrieve the recorded requests that match the httpRequest parameter as a JSON array
*
* <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">httpRequest</span> the http request that is matched against when deciding whether to return each expectation,
*                    use <span class="keyword">null</span> for the parameter to retrieve for all requests
* <span class="javadoc_param_annotation">@return</span> a JSON array of all expectations that have been recorded by the proxy
*/</span>
<span class="keyword">public</span> String retrieveAsJSON(HttpRequest httpRequest);</code></pre>

<a name="create-expectations" class="anchor" href="#create-expectations">&nbsp;</a>

<h3>Create Expectations</h3>

<p>To create an expectation you need to define the <a href="#request-matchers">request matcher</a> and what <a href="#mock-response">response</a> should be returned when the request is matched.</p>

<p>The MockServer will play expectations in the exact order they are setup. For example, if an expectation <span class="annotation">A</span> is setup to response <strong>3</strong> times then expectation <span class="annotation">B</span> is setup to response
	<strong>2</strong> times for the same request the MockServer will response in the following order <span class="annotation">A</span>, <span class="annotation">A</span>, <span class="annotation">A</span>, <span class="annotation">B</span>, <span class="annotation">B</span>.</p>

<p>The following shows a simple expectation example:</p>

<p><strong>Java</strong></p>

<pre><code class="code"><span class="this_value">mockServer</span>
        .when(
                request()
                        .withMethod(<span class="string_literal">"POST"</span>)
                        .withPath(<span class="string_literal">"/login"</span>)
                        .withQueryStringParameters(
                                <span class="keyword">new</span> Parameter(<span class="string_literal">"returnUrl"</span>, <span class="string_literal">"/account"</span>)
                        )
                        .withCookies(
                                <span class="keyword">new</span> Cookie(<span class="string_literal">"sessionId"</span>, <span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>)
                        )
                        .withBody(exact(<span class="string_literal">"{username: 'foo', password: 'bar'}"</span>)),
                exactly(<span class="numeric_literal">1</span>)
        )
        .respond(
                response()
                        .withStatusCode(<span class="numeric_literal">401</span>)
                        .withHeaders(
                                <span class="keyword">new</span> Header(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>),
                                <span class="keyword">new</span> Header(<span class="string_literal">"Cache-Control"</span>, <span class="string_literal">"public, max-age=86400"</span>)
                        )
                        .withBody(<span class="string_literal">"{ message: 'incorrect username and password combination' }"</span>)
                        .withDelay(new Delay(<span class="constant">SECONDS</span>, <span class="numeric_literal">1</span>))
        );</code></pre>

<p><strong>Note:</strong> this requires the use of these static imports as follows:</p>
<code class="code"><span class="keyword">import static</span> org.mockserver.model.HttpRequest.request;
<span class="keyword">import static</span> org.mockserver.model.HttpResponse.response;
<span class="keyword">import static</span> org.mockserver.matchers.Times.exactly;
<span class="keyword">import static</span> java.util.concurrent.TimeUnit.SECONDS;</code>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example test called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/test/java/org/mockserver/web/controller/BooksPageIntegrationTest.java">BookPageIntegrationTest</a> that demonstrates a fully working example.</p>

<p><strong>JavaScript</strong></p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:8080/expectation"</span>, <span class="keyword">false</span>);
xmlHttpRequest.setRequestHeader(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>);
xmlHttpRequest.send(JSON.stringify({
    <span class="string_literal">"httpRequest"</span>: {
        <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
        <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
        <span class="string_literal">"queryStringParameters"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"returnUrl"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"/account"</span>]
            }
        ],
        <span class="string_literal">"cookies"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"sessionId"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>]
            }
        ],
        <span class="string_literal">"body"</span>: {
            <span class="string_literal">"type"</span>: <span class="string_literal">"EXACT"</span>
            <span class="string_literal">"value"</span>: JSON.stringify({ username: <span class="string_literal">"foo"</span>, password: <span class="string_literal">"bar"</span> })
        }
    },
    <span class="string_literal">"httpResponse"</span>: {
        <span class="string_literal">"statusCode"</span>: <span class="numeric_literal">401</span>,
        <span class="string_literal">"headers"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Content-Type"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"application/json; charset=utf-8"</span>]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Cache-Control"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"public, max-age=86400"</span>]
            }
        ],
        <span class="string_literal">"body"</span>: JSON.stringify({ message: <span class="string_literal">"incorrect username and password combination"</span> }),
        <span class="string_literal">"delay"</span>: {
            <span class="string_literal">"timeUnit"</span>: <span class="string_literal">"SECONDS"</span>,
            <span class="string_literal">"value"</span>: <span class="numeric_literal">1</span>
        }
    },
    <span class="string_literal">"times"</span>: {
        <span class="string_literal">"remainingTimes"</span>: <span class="numeric_literal">1</span>,
        <span class="string_literal">"unlimited"</span>: <span class="keyword">false</span>
    }
}));
</code></pre>

<a name="request-matchers" class="anchor" href="#request-matchers">&nbsp;</a>

<h3>Request Matcher</h3>

<p>To specify when a response should be mocked a request matcher must be provided in each expectation.</p>

<p>When an incoming request matches the request matcher in an expectation MockServer will return the response for that expectation.</p>

<p>Requests can be matched on:</p>

<ul>
	<li><strong>url</strong> - regex or plain text</li>
	<li><strong>path</strong> - regex or plain text</li>
	<li><strong>query string</strong> - regex or plain text</li>
	<li><strong>headers</strong> - regex or plain text</li>
	<li><strong>cookies</strong> - regex or plain text</li>
	<li><strong>body</strong> - XPath, regex, plain text (exact match), or body parameters</li>
</ul>

<p>The body can be matched using plain text, an XPath expression or a regular expression, see <a href="http://saxon.sourceforge.net/saxon6.5.3/expressions.html">XPath Expression Syntax</a> for supported XPath syntax.</p>

<p>All other matching can be done using plain text or a regular expression, see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">Pattern (Java Platform SE 7)</a> for supported regular expression syntax.</p>

<p><strong>Java</strong></p>

<p>To specify a request matcher in Java use the org.mockserver.model.HttpRequest class which specifies the details of each HTTP response with a fluent API:</p>

<pre><code class="code"><span class="keyword">public class</span> HttpRequest {

    <span class="comment">/**
     * The HTTP method to match on such as <span class="string_literal">"GET"</span> or <span class="string_literal">"POST"</span>
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">method</span> the HTTP method such as <span class="string_literal">"GET"</span> or <span class="string_literal">"POST"</span>
     */</span>
    <span class="keyword">public</span> HttpRequest withMethod(String method);

    <span class="comment">/**
     * The URL to match on such as <span class="string_literal">"http://localhost:9999/some_mocked_path"</span> regex values are also
     * supported such as <span class="string_literal">".*some_mocked_path"</span>, see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>
     * for full details of the supported regex syntax
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">url</span> the full URL such as <span class="string_literal">"http://localhost:9999/some_mocked_path"</span> or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withURL(String url);

    <span class="comment">/**
     * The path to match on such as <span class="string_literal">"/some_mocked_path"</span> any servlet context path is ignored for matching and should not be specified here
     * regex values are also supported such as <span class="string_literal">".*_path"</span>, see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>
     * for full details of the supported regex syntax
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">path</span> the path such as <span class="string_literal">"/some_mocked_path"</span> or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withPath(String path);

    <span class="comment">/**
     * The query string - this method only currently supports an exact match such as <span class="string_literal">"param=value&otherParam=otherValue"</span> or a regex match,
     * see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a> for full details of the supported regex syntax
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">queryString</span> the query string such as <span class="string_literal">"someParameter=someValue&someOtherParameter=someOtherValue"</span> or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withQueryString(String queryString);

    <span class="comment">/**
     * The body to match on such as <span class="string_literal">"{username: 'foo', password: 'bar'}"</span> or a regex (see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     * or an XPath expression which returns one or more values or evaluates to true (see <a href="http://saxon.sourceforge.net/saxon6.5.3/expressions.html">http://saxon.sourceforge.net/saxon6.5.3/expressions.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">body</span> the body on such as <span class="string_literal">"{username: 'foo', password: 'bar'}"</span>
     *             or a regex such as <span class="string_literal">"username[a-z]{4}"</span>
     *             or an XPath such as <span class="string_literal">"/element[key = 'some_key' and value = 'some_value']"</span>
     */</span>
    <span class="keyword">public</span> HttpRequest withBody(String body);

    <span class="comment">/**
     * The headers to match on as a list of Header objects where the values or keys of each header can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">headers</span> the list of Header objects where the values or keys of each header can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withHeaders(List&lt;Header&gt; headers);
    <span class="comment">/**
     * The headers to match on as a varags of Header objects  where the values or keys of each header can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">headers</span> the varags of Header objects where the values or keys of each header can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withHeaders(Header... headers);

    <span class="comment">/**
     * The cookies to match on as a list of Cookie objects  where the values or keys of each cookie can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">cookies</span> the list of Cookie objects where the values or keys of each cookie can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withCookies(List&lt;Cookie&gt; cookies);
    <span class="comment">/**
     * The cookies to match on as a varags Cookie objects where the values or keys of each cookie can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">cookies</span> the varags Cookie objects where the values or keys of each cookie can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withCookies(Cookie... cookies);
}</code></pre>

<p>For example:</p>

<pre><code class="code">HttpRequest httpRequest =
        request()
                .withMethod(<span class="string_literal">"POST"</span>)
                .withPath(<span class="string_literal">"/login"</span>)
                .withBody(<span class="string_literal">"{username: 'foo', password: 'bar'}"</span>)
                .withQueryStringParameters(
                        <span class="keyword">new</span> Parameter(<span class="string_literal">"returnUrl"</span>, <span class="string_literal">"/account"</span>)
                )
                .withCookies(
                        <span class="keyword">new</span> Cookie(<span class="string_literal">"sessionId"</span>, <span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>)
                );</code></pre>

<p><strong>JavaScript</strong></p>

<p>To specify a request matcher in javascript use JSON to specify the details with the following format: </p>

<pre><code class="code"><span class="string_literal">"httpRequest"</span>: {
    <span class="string_literal">"method"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"path"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"queryParameters"</span>: []
    <span class="string_literal">"body"</span>: {
       <span class="string_literal">"type"</span>: <span class="annotation">&lt;</span><span class="string_literal">"REGEX"</span> <span class="annotation">or</span> <span class="string_literal">"EXACT"</span> <span class="annotation">or</span> <span class="string_literal">"XPATH"</span> <span class="annotation">or</span> <span class="string_literal">"PARAMETERS"</span><span class="annotation">&gt;</span>,
       <span class="string_literal">"value"</span>: <span class="string_literal">""</span> <span class="annotation">( or</span> <span class="string_literal">"parameters"</span> <span class="annotation">as shown in more detail below )</span>
    },
    <span class="string_literal">"cookies"</span>: [],
    <span class="string_literal">"headers"</span>: [],
}</code></pre>

<p><strong>Note:</strong> Only values which are matched on need to be specified, if a value is missing then it will not be matched on. For example, below both the parameters and headers fields are not specified.</p>

<p>Each cookie, header or parameter array entry has the following syntax:</p>

<pre><code class="code">{
    <span class="string_literal">"name"</span>: <span class="string_literal">"someName"</span>,
    <span class="string_literal">"values"</span>: [<span class="string_literal">"someValueOne"</span>, <span class="string_literal">"someValueTwo"</span>, ...]
}</code></pre>

<p>The same example, as in Java above, in JavaScript would be :</p>

<pre><code class="code"><span class="string_literal">"httpRequest"</span>: {
    <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
    <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
    <span class="string_literal">"queryStringParameters"</span>: [
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"returnUrl"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"/account"</span>]
        }
    ],
    <span class="string_literal">"cookies"</span>: [
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"sessionId"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>]
        }
    ],
    <span class="string_literal">"body"</span>: {
        <span class="string_literal">"type"</span>: <span class="string_literal">"EXACT"</span>,
        <span class="string_literal">"value"</span>: <span class="string_literal">"{username: 'foo', password: 'bar'}"</span>
    }
}</code></pre>

<p>The <span class="string_literal">"type"</span> value in <span class="string_literal">"body"</span> can be:</p>

<pre><code class="code"><span class="string_literal">"EXACT"</span>
<span class="string_literal">"REGEX"</span>
<span class="string_literal">"XPATH"</span>
<span class="string_literal">"PARAMETERS"</span></code></pre>

<p>When the <span class="string_literal">"type"</span> field has a value of <span class="string_literal">"EXACT"</span>, <span class="string_literal">"REGEX"</span> or <span class="string_literal">"XPATH"</span> the other field of <span class="string_literal">"body"</span>" should be <span class="string_literal">"value"</span> and it should provide a string to perform the match against, as shown in the example above.</p>
<p>When the <span class="string_literal">"type"</span> field has a value of <span class="string_literal">"PARAMETERS"</span> the other field of <span class="string_literal">"body"</span>" should be <span class="string_literal">"parameters"</span> and it should provide a list of body parameters using the following syntax:</p>

<pre><code class="code">{
    <span class="string_literal">"name"</span>: <span class="string_literal">"someName"</span>,
    <span class="string_literal">"values"</span>: [<span class="string_literal">"someValueOne"</span>, <span class="string_literal">"someValueTwo"</span>, ...]
}</code></pre>

<p>For example:</p>

<pre><code class="code"><span class="string_literal">"httpRequest"</span>: {
    <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
    <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
    <span class="string_literal">"queryStringParameters"</span>: [
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"returnUrl"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"/account"</span>]
        }
    ],
    <span class="string_literal">"cookies"</span>: [
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"sessionId"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>]
        }
    ],
    <span class="string_literal">"body"</span>: {
        <span class="string_literal">"type"</span>: <span class="string_literal">"PARAMETERS"</span>,
        <span class="string_literal">"parameters"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"username"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"foo"</span>]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"password"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"bar"</span>]
            }
        ]
    }
}</code></pre>

<p><strong>Times</strong></p>

<p>The org.mockserver.matchers.Times class is used to specify how many times you want the MockServer to match a request:</p>

<p>To create an instance of Times use one of the static factory methods:</p>

<pre><code class="code">Times.unlimited();
Times.once();
Times.exactly(<span class="keyword">int</span> count);</code></pre>

<a name="mock-response" class="anchor" href="#mock-response">&nbsp;</a>

<h3>Mock Responses</h3>

<p>Responses can contain:</p>

<ul>
	<li><strong>status code</strong> i.e. 200, 302, 404, etc</li>
	<li><strong>body</strong> - a UTF-8 encoded sequence of bytes containing any content</li>
	<li><strong>headers</strong> - each with a name and one or more values</li>
	<li><strong>cookies</strong> - each with a name and with one or more values, more complex cookies can be modelled by using the a Set-Cookie header</li>
</ul>

<p>Responses can be further controlled using:</p>

<ul>
	<li>a delay before the response is sent</li>
	<li>the number of times the response is sent (including unlimited)</li>
</ul>

<p><strong>Java</strong></p>

<p>To mock a response in Java use the org.mockserver.model.HttpResponse class which specifies the details of each HTTP response with a fluent API:</p>

<pre><code class="code"><span class="keyword">public class</span> HttpResponse {

    <span class="comment">/**
     * The status code to return, such as <span class="numeric_literal">200</span>, <span class="numeric_literal">404</span>, the status code specified
     * here will result in the default status message for this status code for
     * example for <span class="numeric_literal">200</span> the status message <span class="string_literal">"OK"</span> is used
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">statusCode</span> an integer such as <span class="numeric_literal">200</span> or <span class="numeric_literal">404</span>
     */</span>
    <span class="keyword">public</span> HttpResponse withStatusCode(Integer responseCode);

    <span class="comment">/**
     * The cookies to return as Set-Cookie headers as a list of Cookie objects
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">cookies</span> a list of Cookie objects
     */</span>
    <span class="keyword">public</span> HttpResponse withCookies(List&lt;Cookie&gt; cookies);
    <span class="comment">/**
     * The cookies to return as Set-Cookie headers as a varargs of Cookie objects
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">cookies</span> a varargs of Cookie objects
     */</span>
    <span class="keyword">public</span> HttpResponse withCookies(Cookie... cookies);

    <span class="comment">/**
     * The headers to return as a list of Header objects
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">headers</span> a list of Header objects
     */</span>
    <span class="keyword">public</span> HttpResponse withHeaders(List&lt;Header&gt; headers);
    <span class="comment">/**
     * The headers to return as a varargs of Header objects
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">headers</span> a varargs of Header objects
     */</span>
    <span class="keyword">public</span> HttpResponse withHeaders(Header... headers);

    <span class="comment">/**
     * The response body
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">body</span> a <span class="string_literal">"UTF-8"</span> string
     */</span>
    <span class="keyword">public</span> HttpResponse withBody(String body);

    <span class="comment">/**
     * The delay before responding with this request as a Delay object, for example <span class="keyword">new</span> Delay(TimeUnit.<span class="constant">SECONDS</span>, <span class="numeric_literal">3</span>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">delay</span> a Delay object, for example <span class="keyword">new</span> Delay(TimeUnit.<span class="constant">SECONDS</span>, <span class="numeric_literal">3</span>)
     */</span>
    <span class="keyword">public</span> HttpResponse withDelay(Delay delay);
}</code></pre>

<p>For example:</p>

<pre><code class="code">HttpResponse httpResponse =
        response()
                .withStatusCode(<span class="numeric_literal">401</span>)
                .withHeaders(
                        new Header(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>),
                        new Header(<span class="string_literal">"Cache-Control"</span>, <span class="string_literal">"public, max-age=86400"</span>)
                )
                .withBody(<span class="string_literal">"{ message: 'incorrect username and password combination' }"</span>)
                .withDelay(new Delay(TimeUnit.<span class="constant">SECONDS</span>, <span class="numeric_literal">1</span>));
</code></pre>

<p><strong>JavaScript</strong></p>

<p>To mock a response in javascript use JSON to specify the details with the following format: </p>

<pre><code class="code"><span class="string_literal">"httpResponse"</span>: {
    <span class="string_literal">"statusCode"</span>: <span class="numeric_literal">200</span>,
    <span class="string_literal">"body"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"cookies"</span>: [],
    <span class="string_literal">"headers"</span>: [],
    <span class="string_literal">"delay"</span>: {
        <span class="string_literal">"timeUnit"</span>: <span class="string_literal">"MICROSECONDS"</span>,
        <span class="string_literal">"value"</span>: <span class="numeric_literal">0</span>
    }
}
</code></pre>

<p>Each cookie or header array entry has the following syntax:</p>

<pre><code class="code">{
    <span class="string_literal">"name"</span>: <span class="string_literal">"someName"</span>,
    <span class="string_literal">"values"</span>: [<span class="string_literal">"someValueOne"</span>, <span class="string_literal">"someValueTwo"</span>, ...]
}</code></pre>

<p>The "timeUnit" value in "delay" can be:</p>

<pre><code class="code"><span class="string_literal">"NANOSECONDS"</span>
<span class="string_literal">"MICROSECONDS"</span>
<span class="string_literal">"MILLISECONDS"</span>
<span class="string_literal">"SECONDS"</span>
<span class="string_literal">"MINUTES"</span>
<span class="string_literal">"HOURS"</span>
<span class="string_literal">"DAYS"</span></code></pre>

<p>The same example as above would be:</p>

<pre><code class="code"><span class="string_literal">"httpResponse"</span>: {
    <span class="string_literal">"statusCode"</span>: <span class="numeric_literal">401</span>,
    <span class="string_literal">"headers"</span>: [
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"Content-Type"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"application/json; charset=utf-8"</span>]
        },
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"Cache-Control"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"public, max-age=86400"</span>]
        }
    ],
    <span class="string_literal">"body"</span>: JSON.stringify({ message: <span class="string_literal">"incorrect username and password combination"</span> }),
    <span class="string_literal">"delay"</span>: {
        <span class="string_literal">"timeUnit"</span>: <span class="string_literal">"SECONDS"</span>,
        <span class="string_literal">"value"</span>: <span class="numeric_literal">1</span>
    }
}</code></pre>

<a name="verify-behaviour" class="anchor" href="#verify-behaviour">&nbsp;</a>

<h2>Verifying Behaviour</h2>

<p>To verify that the system under test has sent a request it must be configured to use the MockServer proxy.  The following examples show how to do this with different HTTP clients.</p>

<h4>Jetty HttpClient 9.x</h4>

<pre><code class="code">HttpClient httpClient = <span class="keyword">new</span> HttpClient();
<span class="keyword">try</span> {
    httpClient.getProxyConfiguration().getProxies().add(<span class="keyword">new</span> HttpProxy(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9090</span>));
    httpClient.start();
} <span class="keyword">catch</span> (Exception e) {
    <span class="keyword">throw new</span> RuntimeException(<span class="string_literal">"Exception creating HttpClient"</span>, e);
}</code></pre>

<h4>Jetty HttpClient 8.x</h4>

<pre><code class="code">HttpClient httpClient = <span class="keyword">new</span> HttpClient();
<span class="keyword">try</span> {
    httpClient.setProxy(<span class="keyword">new</span> Address(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9090</span>));
    httpClient.start();
} <span class="keyword">catch</span> (Exception e) {
    <span class="keyword">throw new</span> RuntimeException(<span class="string_literal">"Exception creating HttpClient"</span>, e);
}</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with Jetty HttpClient called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/jettyclient/BookServiceJettyHttpClient.java">BookServiceJettyHttpClient</a> that demonstrates a fully working example.</p>

<h4>Apache HttpClient</h4>

<pre><code class="code">HttpHost httpHost = <span class="keyword">new</span> HttpHost(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9090</span>);
DefaultProxyRoutePlanner defaultProxyRoutePlanner = <span class="keyword">new</span> DefaultProxyRoutePlanner(httpHost);
HttpClient httpClient = HttpClients.custom().setRoutePlanner(defaultProxyRoutePlanner).build();</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with Apache HttpClient called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/apacheclient/BookServiceApacheHttpClient.java">BookServiceApacheHttpClient</a> that demonstrates a fully working example.</p>

<h4>Jersey</h4>

<pre><code class="code">ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig().register(<span class="keyword">new</span> JacksonFeature())
                                              .connectorProvider(<span class="keyword">new</span> ApacheConnectorProvider());
clientConfig.property(ClientProperties.<span class="constant">PROXY_URI</span>, <span class="string_literal">"http://localhost:9090"</span>);
Client client = ClientBuilder.newClient(clientConfig);</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with Jersey called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/jerseyclient/BookServiceJerseyClient.java">BookServiceJerseyClient</a> that demonstrates a fully working example.</p>

<h4>Spring Rest Template</h4>

<pre><code class="code">RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();
HttpHost httpHost = <span class="keyword">new</span> HttpHost(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9090</span>);
DefaultProxyRoutePlanner defaultProxyRoutePlanner = <span class="keyword">new</span> DefaultProxyRoutePlanner(httpHost);
HttpClient httpClient = HttpClients.custom().setRoutePlanner(defaultProxyRoutePlanner).build();
restTemplate.setRequestFactory(new HttpComponentsClientHttpRequestFactory(httpClient));</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with Spring Rest Template called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/springclient/BookServiceSpringRestTemplateClient.java">BookServiceSpringRestTemplateClient</a> that demonstrates a fully working example.</p>

<h4>Grizzly</h4>

<pre><code class="code">AsyncHttpClientConfig.Builder clientConfigBuilder = <span class="keyword">new</span> AsyncHttpClientConfig.Builder();
clientConfigBuilder.setProxyServerSelector(ProxyUtils.createProxyServerSelector(HttpProxy.proxySelector()));
AsyncHttpClient asyncHttpClient = <span class="keyword">new</span> AsyncHttpClient(clientConfigBuilder.build());</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with Grizzly Http Client called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/grizzlyclient/BookServiceGrizzlyHttpClient.java">BookServiceGrizzlyHttpClient</a> that demonstrates a fully working example.</p>

<p>To verify that a request has been sent use the verify method of the ProxyClient as follows:</p>

 <pre><code class="code"><span class="keyword">new</span> ProxyClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9090</span>).verify(
        request()
                .withMethod(<span class="string_literal">"POST"</span>)
                .withPath(<span class="string_literal">"/login"</span>)
                .withBody(exact(<span class="string_literal">"{username: 'foo', password: 'bar'}"</span>))
                .withCookies(
                        new Cookie(<span class="string_literal">"sessionId"</span>, <span class="string_literal">".*"</span>)
                ),
        Times.exactly(<span class="numeric_literal">1</span>)
);</code></pre>

<p>The org.mockserver.client.proxy.Times class is used to specify how many times you want the MockServer to match a request:</p>

<p>To create an instance of Times use one of the static factory methods:</p>

<pre><code class="code">Times.once();
Times.exactly(<span class="keyword">int</span> count);
Times.atLeast(<span class="keyword">int</span> count);</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example test called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/test/java/org/mockserver/web/controller/BooksPageIntegrationTest.java">BookPageIntegrationTest</a> that demonstrates a fully working example.</p>

<a name="analysing-behaviour" class="anchor" href="#analysing-behaviour">&nbsp;</a>

<h2>Analysing Behaviour</h2>

<p>To analyse the requests that system makes the proxy can be used to record all requests and write them into the <span class="annotation">mockserver_request.log</span>. This can be particularly helpful when refactoring an existing or legacy system.</p>

<p>The requests can be written to the log in JSON or as Java code. The Java code can then be used to setup expectations in the MockServer and exactly replay all interactions.</p>

<p>First the system that is being analysed must be configured to use the proxy.</p>

<p>If the proxy is being started programmatically from within the same JVM using <span class="annotation">org.mockserver.proxy.ProxyRunner</span> or <span class="annotation">org.mockserver.integration.ClientAndProxy</span> then the environment variables for <strong>"proxySet"</strong>,
	<strong>"http.proxyHost"</strong> and <strong>"http.proxyPort"</strong> will be set automatically.</p>

<p>If the proxy is being started as separate JVM, for example using <a href="#running-from-command-line">the command line</a>, then the system being analysed needs the following command line options to set the correct environment variables.</p>

<pre><code class="code">-DproxySet=true -Dhttp.proxyHost=&lt;proxy hostname&gt; -Dhttp.proxyPort=&lt;proxy port&gt;</code></pre>

<p>For example:</p>

<pre><code class="code">-DproxySet=true -Dhttp.proxyHost=localhost -Dhttp.proxyPort=9090</code></pre>

<h4>Apache HttpClient</h4>

<p>To configure the proxy with an Apache HttpClient, as follows:</p>

<pre><code class="code"><span class="keyword">public</span> HttpClient createHttpClient() {
    <span class="keyword">if</span> (Boolean.parseBoolean(System.getProperty(<span class="string_literal">"proxySet"</span>))) {
        HttpHost httpHost = <span class="keyword">new</span> HttpHost(System.getProperty(<span class="string_literal">"http.proxyHost"</span>), Integer.parseInt(System.getProperty(<span class="string_literal">"http.proxyPort"</span>)));
        DefaultProxyRoutePlanner defaultProxyRoutePlanner = <span class="string_literal">new</span> DefaultProxyRoutePlanner(httpHost);
        <span class="string_literal">return</span> HttpClients.custom().setRoutePlanner(defaultProxyRoutePlanner).build();
    } <span class="string_literal">else</span> {
        <span class="string_literal">return</span> HttpClients.custom().build();
    }
}</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with a Apache HttpClient called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/apacheclient/BookServiceApacheHttpClient.java">BookServiceApacheHttpClient</a> that demonstrates a fully working example.</p>

<h4>Grizzly AsyncHttpClient</h4>

<p>To configure the proxy with a Grizzly AsyncHttpClient, as follows:</p>

<pre><code class="code"><span class="keyword">public</span> AsyncHttpClient createHttpClient() {
    AsyncHttpClientConfig.Builder clientConfigBuilder = <span class="keyword">new</span> AsyncHttpClientConfig.Builder();
    <span class="keyword">if</span> (Boolean.parseBoolean(System.getProperty(<span class="string_literal">"proxySet"</span>))) {
        clientConfigBuilder.setProxyServerSelector(ProxyUtils.createProxyServerSelector(ProxyRunner.proxySelector()));
    }
    <span class="keyword">return new</span> AsyncHttpClient(clientConfigBuilder.build());
}</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with a Grizzly AsyncHttpClient called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/grizzlyclient/BookServiceGrizzlyHttpClient.java">BookServiceGrizzlyHttpClient</a> that demonstrates a fully working example.</p>

<h4>Jersey Client</h4>

<p>To configure the proxy with a Jersey Client, as follows:</p>

<pre><code class="code"><span class="keyword">public</span> Client createHttpClient() {
    ClientConfig clientConfig = <span class="keyword">new</span> ClientConfig()
            .register(<span class="keyword">new</span> JacksonFeature())
            .connectorProvider(<span class="keyword">new</span> ApacheConnectorProvider());
    <span class="keyword">if</span> (Boolean.parseBoolean(System.getProperty(<span class="string_literal">"proxySet"</span>))) {
        clientConfig.property(ClientProperties.PROXY_URI, <span class="string_literal">"http://"</span> + System.getProperty(<span class="string_literal">"http.proxyHost"</span>) + <span class="string_literal">":"</span> + System.getProperty(<span class="string_literal">"http.proxyPort"</span>));
    }
    <span class="keyword">return</span> ClientBuilder.newClient(clientConfig);
}</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with a Jersey Client called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/jerseyclient/BookServiceJerseyClient.java">BookServiceJerseyClient</a> that demonstrates a fully working example.</p>

<h4>Jetty HttpClient</h4>

<p>To configure the proxy with a Jetty HttpClient, as follows:</p>

<pre><code class="code"><span class="keyword">public</span> HttpClient createHttpClient() {
    HttpClient httpClient = <span class="keyword">new</span> HttpClient();
    <span class="keyword">try</span> {
        if (Boolean.parseBoolean(System.getProperty(<span class="string_literal">"proxySet"</span>))) {
            httpClient.getProxyConfiguration().getProxies().add(<span class="keyword">new</span> HttpProxy(System.getProperty(<span class="string_literal">"http.proxyHost"</span>), Integer.parseInt(System.getProperty(<span class="string_literal">"http.proxyPort"</span>))));
        }
        httpClient.start();
    } <span class="keyword">catch</span> (Exception e) {
        <span class="keyword">throw new</span> RuntimeException(<span class="string_literal">"Exception creating HttpClient"</span>, e);
    }
    <span class="keyword">return</span> httpClient;
}</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with a Jetty HttpClient called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/apacheclient/BookServiceApacheHttpClient.java">BookServiceJettyHttpClient</a> that demonstrates a fully working example.</p>

<h4>Spring RestTemplate</h4>

<p>To configure the proxy with a Spring RestTemplate, as follows:</p>

<pre><code class="code"><span class="keyword">public</span> RestTemplate createRestTemplate() {
    <span class="comment">// jackson message converter</span>
    MappingJacksonHttpMessageConverter mappingJacksonHttpMessageConverter = <span class="keyword">new</span> MappingJacksonHttpMessageConverter();
    mappingJacksonHttpMessageConverter.setObjectMapper(objectMapper);

    <span class="comment">// create message converters list</span>
    List&lt;HttpMessageConverter&lt;?&gt;&gt; httpMessageConverters = <span class="keyword">new</span> ArrayList<>();
    httpMessageConverters.add(mappingJacksonHttpMessageConverter);

    <span class="comment">// create rest template</span>
    RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();
    restTemplate.setMessageConverters(httpMessageConverters);

    <span class="comment">// configure proxy</span>
    <span class="keyword">if</span> (Boolean.parseBoolean(System.getProperty(<span class="string_literal">"proxySet"</span>))) {
        HttpHost httpHost = <span class="keyword">new</span> HttpHost(
                System.getProperty(<span class="string_literal">"http.proxyHost"</span>),
                Integer.parseInt(System.getProperty(<span class="string_literal">"http.proxyPort"</span>))
        );
        DefaultProxyRoutePlanner defaultProxyRoutePlanner = <span class="keyword">new</span> DefaultProxyRoutePlanner(httpHost);
        HttpClient httpClient = HttpClients.custom().setRoutePlanner(defaultProxyRoutePlanner).build();
        restTemplate.setRequestFactory(<span class="keyword">new</span> HttpComponentsClientHttpRequestFactory(httpClient));
    }

    <span class="keyword">return</span> restTemplate;
}</code></pre>

<p>The <a href="https://github.com/jamesdbloom/mockserver/tree/master/mockserver-examples">mockserver-example</a> project contains an example of using the proxy with a Spring RestTemplate called
	<a href="https://github.com/jamesdbloom/mockserver/blob/master/mockserver-examples/src/main/java/org/mockserver/service/springclient/BookServiceSpringRestTemplateClient.java">BookServiceSpringRestTemplateClient</a> that demonstrates a fully working example.</p>

<p><strong>Write Requests To Log</strong></p>

<p>Write the recorded request to the log as Java code, as follows:</p>

 <pre><code class="code"><span class="keyword">new</span> ProxyClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9090</span>).dumpToLogAsJava(
        request()
                .withMethod(<span class="string_literal">"POST"</span>)
                .withPath(<span class="string_literal">"/login"</span>)
);</code></pre>

<p>The Java code format that requests are written to the logs is as follows:</p>

<pre><code class="code">2014-01-12 21:46:33,305
<span class="keyword">new</span> MockServerClient()
        .when(
                request()
                        .withMethod(<span class="string_literal">"GET"</span>)
                        .withURL(<span class="string_literal">"http://localhost:8080/get_book?id=1"</span>)
                        .withPath(<span class="string_literal">"/get_book"</span>)
                        .withQueryString(<span class="string_literal">"id=1"</span>)
                        .withHeaders(
                                new Header(<span class="string_literal">"Accept-Encoding"</span>, <span class="string_literal">"gzip"</span>),
                                new Header(<span class="string_literal">"Host"</span>, <span class="string_literal">"localhost:1090"</span>),
                                new Header(<span class="string_literal">"User-Agent"</span>, <span class="string_literal">"Jetty/8.1.13.v20130916"</span>)
                        ),
                Times.once()
        )
        .thenRespond(
                response()
                        .withStatusCode(<span class="numeric_literal">200</span>)
                        .withHeaders(
                                new Header(<span class="string_literal">"Server"</span>, <span class="string_literal">"Jetty(8.1.13.v20130916)"</span>)
                        )
                        .withBody(<span class="string_literal">"{\n        \"id\": \"1\",\n        \"title\": \"Xenophon's imperial fiction : on the education of Cyrus\",\n        \"author\": \"James Tatum\",\n        \"isbn\": \"0691067570\",\n        \"publicationDate\": \"1989\"\n    }"</span>)
        );</code></pre>

<p>Write the recorded request to the log as JSON, as follows:</p>

 <pre><code class="code"><span class="keyword">new</span> ProxyClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9090</span>).dumpToLogAsJSON(
        request()
                .withMethod(<span class="string_literal">"POST"</span>)
                .withPath(<span class="string_literal">"/login"</span>)
);</code></pre>

<p>The JSON format that requests are written to the logs is as follows:</p>

<pre><code class="code">2014-01-12 21:46:33,299 {
    <span class="string_literal">"httpRequest"</span> : {
        <span class="string_literal">"method"</span> : <span class="string_literal">"GET"</span>,
        <span class="string_literal">"url"</span> : <span class="string_literal">"http://localhost:8080/get_book?id=1"</span>,
        <span class="string_literal">"path"</span> : <span class="string_literal">"/get_book"</span>,
        <span class="string_literal">"queryString"</span> : <span class="string_literal">"id=1"</span>,
        <span class="string_literal">"headers"</span> : [
            {
                <span class="string_literal">"name"</span> : <span class="string_literal">"Accept-Encoding"</span>,
                <span class="string_literal">"values"</span> : [ <span class="string_literal">"gzip"</span> ]
            },
            {
                <span class="string_literal">"name"</span> : <span class="string_literal">"Host"</span>,
                <span class="string_literal">"values"</span> : [ <span class="string_literal">"localhost:8080"</span> ]
            },
            {
                <span class="string_literal">"name"</span> : <span class="string_literal">"User-Agent"</span>,
                <span class="string_literal">"values"</span> : [ <span class="string_literal">"Jetty/8.1.13.v20130916"</span> ]
            } ]
    },
    <span class="string_literal">"httpResponse"</span> : {
        <span class="string_literal">"statusCode"</span> : <span class="numeric_literal">200</span>,
        <span class="string_literal">"body"</span> : <span class="string_literal">"{\n    \"id\": \"1\",\n    \"title\": \"Xenophon's imperial fiction : on the education of Cyrus\",\n    \"author\": \"James Tatum\",\n    \"isbn\": \"0691067570\",\n    \"publicationDate\": \"1989\"\n}"</span>,
        <span class="string_literal">"headers"</span> : [ {
            <span class="string_literal">"name"</span> : <span class="string_literal">"Server"</span>,
            <span class="string_literal">"values"</span> : [ <span class="string_literal">"Jetty(8.1.13.v20130916)"</span> ]
        } ]
    },
    <span class="string_literal">"times"</span> : {
        <span class="string_literal">"remainingTimes"</span> : <span class="numeric_literal">1</span>,
        <span class="string_literal">"unlimited"</span> : <span class="keyword">false</span>
    }
}</code></pre>

<a name="ensuring-tests-can-run-in-parallel" class="anchor" href="#ensuring-tests-can-run-in-parallel">&nbsp;</a>

<h2>Running Tests In Parallel</h2>

<p>To ensure all tests can run in parallel with completely isolated independent data it is important to include a value unique to each test for the request matcher. </p>

<p>For example the code above has a sessionId cookie in the request matcher. If each test generates a different value (i.e. a UUID) for the sessionId cookie then each test can receive completely independent response. Instead of a cookie value a query parameter or header (such as the Referer header) can also be used to ensure mock responses are unique to each test.</p>

<a name="clear-and-reset" class="anchor" href="#clear-and-reset">&nbsp;</a>

<h2>Clear &amp; Reset</h2>

<p>To clear <strong>all expectations</strong> (without restarting) use <strong>reset</strong> as follows:</p>

<p><strong>Java</strong></p>

<pre><code class="code">mockServerClient.reset()</code></pre>

<p><strong>JavaScript</strong></p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:9999/reset"</span>, <span class="keyword">false</span>);
xmlHttpRequest.send();</code></pre>

<p>To clear <strong>only specific</strong> expectations use <strong>clear</strong> as follows:</p>

<p><strong>Java</strong></p>

<pre><code class="code">mockServerClient.clear(
        request()
                .withMethod(<span class="string_literal">"POST"</span>)
                .withPath(<span class="string_literal">"/login"</span>)
);</code></pre>

<p><strong>JavaScript</strong></p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:9999/clear"</span>, <span class="keyword">false</span>);
xmlHttpRequest.setRequestHeader(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>);
xmlHttpRequest.send(JSON.stringify({
    <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
    <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
}));</code></pre>

<p>The example above clears all expectations that will match incoming requests with a <strong>POST</strong> method on the path <strong>/login</strong>.</p>

<a name="debugging-issues" class="anchor" href="#debugging-issues">&nbsp;</a>

<h2>Debugging Issues</h2>

<p>To simplify debugging the MockServer expectations can be dumped to the log at WARN level using pretty-printed JSON.</p>

<p>To dump <strong>all expectations</strong> to the log use <strong>dumpToLog</strong> as follows:</p>

<p><strong>Java</strong></p>

<pre><code class="code">mockServerClient.dumpToLog()</code></pre>

<p><strong>JavaScript</strong></p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:9999/dumpToLog"</span>, <span class="keyword">false</span>);
xmlHttpRequest.send();</code></pre>

<p>To dump <strong>only specific</strong> expectations to the log use <strong>dumpToLog</strong> as follows:</p>

<p><strong>Java</strong></p>

<pre><code class="code">mockServerClient.dumpToLog(
        request()
                .withMethod(<span class="string_literal">"POST"</span>)
                .withPath(<span class="string_literal">"/login"</span>)
);</code></pre>

<p><strong>JavaScript</strong></p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:9999/dumpToLog"</span>, <span class="keyword">false</span>);
xmlHttpRequest.send(JSON.stringify({
    <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
    <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
}));</code></pre>

<p>The example above dumps all expectations that match incoming requests with a <strong>POST</strong> method on the path <strong>/login</strong>.</p>

<a name="requirements" class="anchor" href="#requirements">&nbsp;</a>

<h2>Requirements</h2>

<ul>
	<li><strong>Java 6+</strong>&nbsp;&nbsp;&nbsp;to use the Netty version, the Maven Plugin and MockServer WAR and proxy WAR</li>
	<li><strong>Java 7+</strong>&nbsp;&nbsp;&nbsp;to use the Vert.X module or the Embedded Jetty version as both Jetty 9 and Vert.X in turn require Java 7 (<strong>Note:</strong> all features provided in the Embedded Jetty version are also available using the Netty version)</li>
</ul>

<a name="downloads" class="anchor" href="#versions">&nbsp;</a>

<h2>Downloads</h2>

<p>The simplest way to run and download MockServer is by using the fully stand alone web server embedded with all dependencies that mocks HTTP and HTTPS requests, as follows:</p>

<ol>
	<li><p>download <a href="http://search.maven.org/remotecontent?filepath=org/mock-server/mockserver-netty/2.9/mockserver-netty-2.9-jar-with-dependencies.jar">mockserver-netty-2.9-jar-with-dependencies.jar</a> from Maven Central</p></li>
	<li>
		<code class="code inline">java -jar &lt;path to mockserver-netty-2.9-jar-with-dependencies.jar&gt; -serverPort &lt;port&gt;</code>
	</li>
</ol>

<p class="sub_title">For more details on downloads see:</p>

<ul>
	<li><p>jar-with-dependencies / jar / war packages at <a href="#maven-central">MockServer on Maven Central</a>.</p></li>
	<li><p>Vert.X Modules at <a href="#vertx-registry">MockServer on Vert.X Module Registry</a>.</p></li>
	<li><p>source code at <a href="#github">MockServer on GitHub</a>.</p></li>
</ul>

<a name="github" class="anchor" href="#github">&nbsp;</a>

<h2>GitHub</h2>

<p>The source control for MockServer is git which is hosted at GitHub <a href="https://github.com/jamesdbloom/mockserver">jamesdbloom/mockserver</a></p>

<p>GitHub is also used to track issues / bugs and manage pull-requests.</p>

<a name="maven-central" class="anchor" href="#maven-central">&nbsp;</a>

<h2>Maven Central</h2>

<p>Maven Central contains the following MockServer artifacts:</p>

<ul>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-netty">mockserver-netty</a> - a web server for mocking and proxying using Netty</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-netty">mockserver-netty:jar-with-dependencies</a> - as above using Netty that includes all dependencies are bundled into the jar file</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-jetty">mockserver-jetty</a> - a web server for mocking and proxying using Embedded Jetty</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-jetty">mockserver-jetty:jar-with-dependencies</a> - as above using Jetty that includes all dependencies are bundled into the jar file</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-vertx">mockserver-vertx</a> - a Vert.X module for mocking and proxying</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-war">mockserver-war</a> - a deployable WAR for mocking and proxying that can be deployed to any JEE web server</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-maven-plugin">mockserver-maven-plugin</a> - a set of maven plugins to start, stop and fork MockServer using maven</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-client">mockserver-client</a> - a Java and JavaScript client to communicate with both the server and the proxy</li>
</ul>

<p>In addition MockServer SNAPSHOT artifacts can also be found at <a href="https://oss.sonatype.org/index.html#nexus-search;quick%7Emockserver">https://oss.sonatype.org/index.html#nexus-search;quick~mockserver</a>.</p>

<a name="vertx-registry" class="anchor" href="#vertx-registry">&nbsp;</a>

<h2>Vert.X Module Registry</h2>

<p>Vert.X Module Registry contains the following artifacts:</p>

<ul>
	<li><a href="http://modulereg.vertx.io/">org.mock-server~mockserver-vertx~2.9</a> - a Vert.X module that mocks HTTP and HTTPS requests</li>
</ul>

<p>Vert.X Module Registry will shortly also have the following artifacts:</p>

<ul>
	<li><a href="http://modulereg.vertx.io/">org.mock-server~mockserver-vertx-proxy~2.9</a> - a Vert.X module that proxies HTTP and HTTPS allowing the recording and querying of requests and responses</li>
</ul>

<a name="docker" class="anchor" href="#docker">&nbsp;</a>

<h2>Docker Container</h2>

<p>MockServer is available as a docker container that allows you to easily run MockServer as a separate container on any environment without having to install Java or any other libraries.  The docker container fully encapsulates all requirements required to run MockServer (such as Java) and separates the running MockServer instance from all other parts of the system.</p>

<p>The MockServer docker container can be found at <a href="https://index.docker.io/u/jamesdbloom/mockserver/">MockServer Docker</a></p>

<a name="continuous-integration" class="anchor" href="#continuous-integration">&nbsp;</a>

<h2>Travis CI</h2>

<p><a href="https://travis-ci.org/jamesdbloom/mockserver">Travis CI</a> is used for the continuous integration.  The build uses both Java 1.6 and Java 1.7 to build the different modules in their appropriate java version, the latest SNAPSHOT is also deployed to <a href="https://oss.sonatype.org/index.html#nexus-search;quick%7Emockserver">Sonatype</a>.</p>
<p>The status of the build is shown at the top of this page and on the github project using the Travis CI logo &nbsp;&nbsp;<a href="https://travis-ci.org/jamesdbloom/mockserver"><img src="https://github-camo.global.ssl.fastly.net/2e2b9deeda5c745f167e2cabcd787322df06688f/68747470733a2f2f7472617669732d63692e6f72672f6a616d657364626c6f6f6d2f6d6f636b7365727665722e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/jamesdbloom/mockserver.png?branch=master" style="max-width:100%;"></a></p>

<h2>drone.io</h2>

<p><a href="https://drone.io/github.com/jamesdbloom/mockserver">drone.io</a> is an alternative continuous integration
    platform also being used. Currently both Travis CI and drone.io are being used to determine which platform works
    better for MockServer.</p>
<p>The status of the drone.io build is as follows: <a href="https://drone.io/github.com/jamesdbloom/mockserver"><img
        src="https://drone.io/github.com/jamesdbloom/mockserver/status.png" alt="Build Status"></a></p>

<a name="backlog" class="anchor" href="#backlog">&nbsp;</a>

<h2>Backlog</h2>

<p><a href="https://waffle.io/jamesdbloom/mockserver">Waffle</a> is used to visualise the backlog, although all the items are stored in <a href="https://github.com/jamesdbloom/mockserver/issues?milestone=&page=1&state=open">Github</a>.</p>
<p>The following icons shows the status of the backlog:     <a href="https://waffle.io/jamesdbloom/mockserver"><img src="https://camo.githubusercontent.com/7cb4115a381b12f2730184fd28e238e98450b98c/68747470733a2f2f62616467652e776166666c652e696f2f6a616d657364626c6f6f6d2f6d6f636b7365727665722e706e673f6c6162656c3d70726f706f73616c267469746c653d50726f706f73616c73" alt="Stories in Backlog" data-canonical-src="https://badge.waffle.io/jamesdbloom/mockserver.png?label=proposal&amp;title=Proposals" style="max-width:100%;"></a>
    <a href="https://waffle.io/jamesdbloom/mockserver"><img src="https://camo.githubusercontent.com/0c25a2c44f691aa43b5fec8c8b3617f3eb16740b/68747470733a2f2f62616467652e776166666c652e696f2f6a616d657364626c6f6f6d2f6d6f636b7365727665722e706e673f6c6162656c3d7265616479267469746c653d5265616479" alt="Stories in Backlog" data-canonical-src="https://badge.waffle.io/jamesdbloom/mockserver.png?label=ready&amp;title=Ready" style="max-width:100%;"></a>
    <a href="https://waffle.io/jamesdbloom/mockserver"><img src="https://camo.githubusercontent.com/6cb0a7e54cd194e04a1ee2ae891c1e295969d152/68747470733a2f2f62616467652e776166666c652e696f2f6a616d657364626c6f6f6d2f6d6f636b7365727665722e706e673f6c6162656c3d696e25323070726f6772657373267469746c653d496e25323050726f6772657373" alt="Stories in Backlog" data-canonical-src="https://badge.waffle.io/jamesdbloom/mockserver.png?label=in%20progress&amp;title=In%20Progress" style="max-width:100%;"></a></p>

<p><br><a href="https://plus.google.com/110954472544793839756?rel=author">James D Bloom</a> - <a href="http://blog.jamesdbloom.com">Blog</a></p>
<span itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="James D Bloom">
    <meta itemprop="image" content="http://blog.jamesdbloom.com/jamesdbloom.jpg">
    <meta itemprop="givenName" content="James">
    <meta itemprop="familyName" content="Bloom">
    <meta itemprop="gender" content="male">
</span>
<meta itemprop="name" content="MockServer">
<meta itemprop="description" content="An API to easily mock any system or service you integrate with via HTTP or HTTPS from either Java or JavaScript.">
</div>
</div>
</div>
</div>
</body>
<script>
	(function (window, document) {

		var layout = document.getElementById('layout'),
				menu = document.getElementById('menu'),
				menuLink = document.getElementById('menuLink');

		function toggleClass(element, className) {
			var classes = element.className.split(/\s+/),
					length = classes.length,
					i = 0;

			for (; i < length; i++) {
				if (classes[i] === className) {
					classes.splice(i, 1);
					break;
				}
			}
			// The className is not found
			if (length === classes.length) {
				classes.push(className);
			}

			element.className = classes.join(' ');
		}

		menuLink.onclick = function (e) {
			var active = 'active';

			e.preventDefault();
			toggleClass(layout, active);
			toggleClass(menu, active);
			toggleClass(menuLink, active);
		};

	}(this, this.document));
</script>
<script>
	// google analytics
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-32687194-4']);
	_gaq.push(['_trackPageview']);
	(function () {
		var ga = document.createElement('script');
		ga.type = 'text/javascript';
		ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(ga, s);
	})();
</script>
</html>