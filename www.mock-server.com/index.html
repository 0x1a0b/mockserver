<!DOCTYPE html>
<html>
<head>
<title>MockServer</title>
<link rel="author" href="https://plus.google.com/u/0/110954472544793839756">
<link rel="apple-touch-icon-precomposed" href="apple-touch-icon.png"/>
<link rel="shortcut icon" href="apple-touch-icon.png">
<link rel="canonical" href="http://www.mock-server.com/index.html"/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="QIzvnb0rY1MnkLjIDI217X0RjxZCX2tWdUp1CvejoVw"/>
<meta name="msvalidate.01" content="9DBA7A5F05A6179123259382E10FB4A7"/>
<meta id="description" name="description" content="An API to easily mock any system or service you integrate with via HTTP from either Java or JavaScript.">
<meta name="title" content="Mock Server">
<meta property="og:locale" content="en_GB">
<meta property="og:type" content="website">
<meta property="og:url" content="http://www.mock-server.com/">
<meta property="og:site_name" content="MockServer">
<meta property="og:title" content="MockServer">
<meta property="og:description" content="An API to easily mock any system or service you integrate with via HTTP or HTTPS from either Java or JavaScript.">
<link href="//fonts.googleapis.com/css?family=Averia+Sans+Libre:300normal,300italic,400normal,400italic,700normal,700italic|Amatic+SC:400normal|Belleza:400normal|Belgrano:400normal|Open+Sans:400normal|Dosis:400normal|Codystar:400normal|Concert+One:400normal|Oswald:400normal|Economica:400normal|Duru+Sans:400normal&amp;subset=all" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.3.0/pure-min.css">
<style>
body {
	color: #000;
}

/*
Add transition to containers so they can push in and out.
*/
#layout,
#menu,
.menu-link {
	-webkit-transition: all 0.2s ease-out;
	-moz-transition: all 0.2s ease-out;
	-ms-transition: all 0.2s ease-out;
	-o-transition: all 0.2s ease-out;
	transition: all 0.2s ease-out;
}

/*
This is the parent `<div>` that contains the menu and the content area.
*/
#layout {
	padding-left: 200px; /* left col width "#menu" */
	left: 0;
}

/*
The content `<div>` is where all your content goes.
*/
.content {
	margin: 0 auto;
	padding: 0 2em;
	max-width: 1350px;
	margin-bottom: 50px;
	line-height: 1.6em;
}

.header {
	margin: 0;
	color: #333;
	text-align: center;
	padding: 2.5em 2em 0;
	border-bottom: 1px solid #eee;
}

.header h1 {
	margin: 0.2em 0;
	font-weight: 300;
	font: 4em 'Averia Sans Libre', 'Helvetica Neue', Helvetica, Arial, sans-serif;
}

.header h2 {
	font-weight: 300;
	color: #ccc;
	padding: 0;
	margin-top: 0;
}

/*
The `#menu` `<div>` is the parent `<div>` that contains the `.pure-menu` that
appears on the left side of the page.

By using the combination of `position: fixed; top: 0; bottom:0;`, we can make
the menu have 100% height and be fixed on the page as the rest of it scrolls.
*/
#menu {
	margin-left: -200px; /* this should be "#menu" width */
	width: 200px;
	position: fixed;
	top: 0;
	left: 200px; /* this should be "#menu" width */
	bottom: 0;
	z-index: 1; /* so the menu or its navicon stays above all content */
	background: #191818;
	overflow-y: auto;
	-webkit-overflow-scroll: touch; /* for smooth scrolling on mobile */
}

/*
All anchors inside the menu should be styled like this.
*/
#menu a {
	color: #999;
	border: none;
	padding: 0.6em 0 0.6em 0.6em;
}

/*
Remove all background/borders, since we are applying them to #menu.
*/
#menu .pure-menu,
#menu .pure-menu ul {
	border: none;
	background: transparent;
}

/*
Add that light border to separate items into groups.
*/
#menu .pure-menu ul,
#menu .pure-menu .menu-item-divided {

}

/*
Change color of the anchor links on hover/focus.
*/
#menu .pure-menu li a:hover,
#menu .pure-menu li a:focus {
	background: #ffffff;
	color: #000;
}

/*
This styles the selected menu item `<li>`.
*/
#menu .pure-menu-selected,
#menu .pure-menu-heading {
	padding-left: 5px;
	border-bottom: 1px solid #333;
}

#menu div:not(:first-of-type) .pure-menu-selected,
#menu div:not(:first-of-type) .pure-menu-heading {
	border-top: 1px solid #333;
}

/*
This styles a link within a selected menu item `<li>`.
*/
#menu .pure-menu-selected a {
	color: #fff;
}

/*
This styles the menu heading.
*/
#menu .pure-menu-heading {
	font: 110% 'Averia Sans Libre', 'Helvetica Neue', Helvetica, Arial, sans-serif;
	color: #ffffff;
	padding: 10px 10px;
	margin: 0;
}

/* -- Dynamic Button For Responsive Menu -------------------------------------*/

/*
The button to open/close the Menu is custom-made and not part of Pure. Here's
how it works:
*/

/*
`.menu-link` represents the responsive menu toggle that shows/hides on
small screens.
*/
.menu-link {
	display: none; /* show this only on small screens */
	top: 0;
	left: 200px; /* `#menu`'s width */
	background: #000;
	font-size: 10px; /* change this value to increase/decrease button size */
	z-index: 10;
	width: 2em;
	height: auto;
	padding: 2.2em 1.6em;
}

.menu-link:hover,
.menu-link:focus {
	background: #000;
}

.menu-link span {
	position: relative;
	display: block;
}

.menu-link span,
.menu-link span:before,
.menu-link span:after {
	background-color: #fff;
	width: 100%;
	height: 0.2em;
}

.menu-link span:before,
.menu-link span:after {
	position: absolute;
	margin-top: -0.6em;
	content: " ";
}

.menu-link span:after {
	margin-top: 0.6em;
}

a.anchor, a.anchor:hover, a.anchor:active, a.anchor:focus {
	margin-bottom: 100px;
	padding-bottom: 100px;
	text-decoration: none;
	border: 0 none;
	outline: 0;
	cursor: default;
}

pre {
	white-space: pre;
	word-wrap: normal;
}

.code {
	display: block;
	white-space: pre;
	overflow: auto;
	width: 95%;
	margin: 1em auto;
	padding: 1em;
	background-color: #0f0101;
	color: #F1F1F1;
	-moz-border-radius: 8px;
	-webkit-border-radius: 8px;
	-o-border-radius: 8px;
	-ms-border-radius: 8px;
	-khtml-border-radius: 8px;
	border-radius: 8px;
	font-family: Menlo, Monaco, "Courier New", monospace;
	font-size: 1em;
	border: 1px solid #888;
}

.inline {
	display: inline-block;
	white-space: pre;
	word-wrap: normal;
	width: 90%;
	overflow: auto;
	margin: 0;
}

.xml {
	color: #C9C9C9;
}

span.keyword {
	color: #5B93DA;
}

span.annotation {
	color: #bdb76b;
}

span.numeric_literal {
	color: #008dff;
}

span.final,
span.constant {
	color: #e28964;
	font-style: italic;
}

span.string_literal,
span.command_line_argument_switch {
	color: #5BA382;
}

span.this_value {
	color: #ff4f31;
}

span.element {
	color: #89bdff;
	/*font-style: italic;*/
	font-size: 0.9em;
	/*font-size: 1.2em;*/
	/*letter-spacing: 1px;*/
}

span.attribute_name,
span.comment,
span.command_line_argument_placeholder {
	color: #9c9c9c;
	font-style: italic;
	font-size: 0.9em;
}

span.comment a {
	color: #6391c3;
	text-decoration: none;
}

span.comment.bold {
	color: gray;
}

span.javadoc_param_name {
	color: #c5c5c5;
}

span.javadoc_param_annotation {
	color: #9c9c9c;
	text-decoration: underline;
}

span.element_value {
	/*font-weight: bold;*/
	font-size: 1.15em;
	/*letter-spacing: 1px;*/
	color: #E28964;
}

span.attribute_value {
	color: blue;
}

.sub_title {
	margin-top: 3em;
	font-weight: bold;
}

/* -- Responsive Styles (Media Queries) ------------------------------------- */

/*
Hides the menu at `767px`, but modify this based on your app's needs.
*/
@media (max-width: 767px) {

	.header {
		/*text-align: left;*/
	}

	.header h1 {
		font-size: 2.5em;
	}

	.header h2 {
		font-size: 1.25em;
	}

	/*
	Navigation Push styles.
	*/
	#layout {
		position: relative;
		padding-left: 0;
	}

	#layout.active {
		position: relative;
		left: 200px;
	}

	#layout.active #menu {
		left: 200px;
		width: 200px;
	}

	#menu {
		left: 0;
	}

	.menu-link {
		position: fixed;
		left: 0;
		display: block; /* show the button on small screens */
	}

	#layout.active .menu-link {
		left: 200px;
	}
}
</style>
</head>
<body>
<div id="layout">
<!-- Menu toggle -->
<a href="#menu" id="menuLink" class="menu-link"><!-- Hamburger icon --><span></span></a>

<div id="menu">
	<div class="pure-menu pure-menu-open">
		<span class="pure-menu-heading">What?</span>
		<ul>
			<li><a href="#what-is-mockserver">What is MockServer</a></li>
			<li><a href="#why-use-mockserver">Features</a></li>
			<li><a href="#versions">Versions</a></li>
			<li><a href="#client">Clients</a></li>
			<li><a href="#requirements">Requirements</a></li>
			<li><a href="#downloads">Downloads</a></li>
			<li><a href="#github">GitHub</a></li>
			<li><a href="#maven-central">Maven Central</a></li>
			<li><a href="#vertx-registry">Vert.X Registry</a></li>
		</ul>
	</div>
	<div class="pure-menu pure-menu-open">
		<span class="pure-menu-heading">How?</span>
		<ul>
			<li><a href="#how-to-use-mockserver">How To Use MockServer</a></li>
			<li><a href="#1-create-mock-response">Mock Responses</a></li>
			<li><a href="#2-setup-mock-expectations">Expectations</a></li>
			<li><a href="#ensuring-tests-can-run-in-parallel">Running Tests In Parallel</a></li>
			<li><a href="#clear--reset">Clear, Reset</a></li>
			<li><a href="#debugging-issues">Debugging Issues</a></li>
		</ul>
	</div>
</div>
<div id="main">
<div class="header">
	<h1>MockServer</h1>

	<h2>Easy mocking of any system you integrate with via HTTP or HTTPS</h2>
</div>
<div class="content" itemscope itemtype="http://schema.org/Article">
<p style="color: #8b0000; text-align: center"><strong><em>This documentation is currently being rewritten to make it clearer, a new version will be completed by mid January 2014</em></strong></p>

<a name="what-is-mockserver" class="anchor" href="#what-is-mockserver">&nbsp;</a>

<h2>What is MockServer</h2>

<p>MockServer is an API to enable the easy mocking of any system you integrate with via HTTP or HTTPS (i.e. services, web sites, etc). There are currently specific clients written in Java and JavaScript although any language that can send JSON via HTTP can easily use the MockServer API.</p>

<h3>Mocking</h3>

<p>To mock an HTTP / HTTPS interaction an expectation is setup specifying how a request should be matched and what response the MockServer should reply with when the request has been matched.</p>

<p>For example:</p>
<pre><code class="code"><span class="keyword">new</span> MockServerClient(<span class="string_literal">"localhost"</span>, <span class="numeric_literal">9999</span>)
        .when(
                request()
                        .withMethod(<span class="string_literal">"POST"</span>)
                        .withPath(<span class="string_literal">"/login"</span>)
                        .withCookies(
                                <span class="keyword">new</span> Cookie(<span class="string_literal">"sessionId"</span>, <span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>)
                        )
                        .withBody(<span class="string_literal">"{username: 'foo', password: 'bar'}"</span>),
                Times.exactly(<span class="numeric_literal">1</span>)
        )
        .respond(
                response()
                        .withStatusCode(<span class="numeric_literal">401</span>)
                        .withHeaders(
                                <span class="keyword">new</span> Header(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>),
                                <span class="keyword">new</span> Header(<span class="string_literal">"Cache-Control"</span>, <span class="string_literal">"public, max-age=86400"</span>)
                        )
                        .withBody(<span class="string_literal">"{ message: 'incorrect username and password combination' }"</span>)
                        .withDelay(new Delay(TimeUnit.<span class="constant">SECONDS</span>, <span class="numeric_literal">1</span>))
        );</code></pre>

<p>Requests can be matched on:</p>

<ul>
	<li>path (regex or plain text)</li>
	<li>body (XPath, regex or plain text)</li>
	<li>headers</li>
	<li>cookies</li>
	<li>query parameters (GET)</li>
	<li>body parameters (POST)</li>
</ul>

<p>Responses can contain:</p>

<ul>
	<li>status code</li>
	<li>body</li>
	<li>headers</li>
	<li>cookies</li>
</ul>

<p>Responses can be further controlled using:</p>

<ul>
	<li>a delay before the response is sent</li>
	<li>the number of times the response is sent (or unlimited)</li>
</ul>

<h3>Proxying</h3>

<p>MockServer also provides an HTTP / HTTPS proxy that can be used to record requests / responses.</p>

<p>Once requests / responses have been recorded:</p>

<ul>
	<li>They can be queried pragmatically to confirm what requests have been sent and what responses have been received.
		<ul>
			<li>This supports test assertions that confirm what requests the system-under-test has been sending during a test.</li>
		</ul>
	</li>
	<li>They can be output in JSON format to log what request the system under has sent and what responses it received.
		<ul>
			<li>This is useful for analysing an existing system prior to writing automated tests.</li>
			<li>This is also useful to simplify the creation of test setup code as the JSON output is in the MockServer expectation format.</li>
		</ul>
	</li>
	<li>They can be output in human readable Java code format that can be pasted directly into a test setup method.
		<ul>
			<li>This is useful to simplify the creation of expectations in test setup methods as the code can be easily pasted directly into a test setup method and then modified as appropriate for the needs of the test scenario.</li>
		</ul>
	</li>
</ul>

<a name="why-use-mockserver" class="anchor" href="#why-use-mockserver">&nbsp;</a>

<h2>Why use MockServer</h2>

<p>MockServer allows you to mock any server or service that you connect to over HTTP or HTTPS, such as a REST or RPC service. </p>

<p>This is useful in the following scenarios:</p>

<ul>
	<li>testing

		<ul>
			<li>easily recreate all types of responses for HTTP dependencies such as REST or RPC services to test applications easily and affectively</li>
			<li>isolate the system under test to ensure tests run reliably and only fail when there is a genuine bug. It is important only the system under test is tested and not its dependencies to avoid tests failing due to irrelevant external changes such as network failure or a server being rebooted / redeployed.</li>
			<li>easily setup mock responses independently for each test to ensure test data is encapsulated with each test. Avoid sharing data between tests that is difficult to manage and maintain and risks tests infecting each other.</li>
		</ul>
	</li>
	<li>de-coupling development

		<ul>
			<li>start working against a service API before the service is available. If an API or service is not yet fully developed MockServer can mock the API allowing any team who is using the service to start work without being delayed.</li>
			<li>isolate development teams particularly critical during the initial development phases when the APIs / services may be extremely unstable and volatile. Using the MockServer allows development work to continue even when an external service fails.</li>
		</ul>
	</li>
</ul>

<a name="versions" class="anchor" href="#versions">&nbsp;</a>

<h2>Versions</h2>

<p>MockServer can be used to <strong>mock HTTP and HTTPS</strong>:</p>

<ul>
	<li>via a Maven plugin (as part of a maven build),</li>
	<li>as a stand alone web server (using Embedded Jetty),</li>
	<li>as a Vert.X module,</li>
	<li>as a deployable WAR that runs on any JEE web server,</li>
</ul>

<p>MockServer can be used as an <strong>HTTP and HTTPS proxy to record and query requests and responses</strong>:</p>

<ul>
	<li>as a stand alone web server (using Embedded Jetty),</li>
	<li>as a Vert.X module (currently only supports HTTP, HTTPS will be available soon),</li>
</ul>

<p>MockServer will soon also be able to run:</p>

<ul>
	<li>as a NodeJS module (however this is currently been written and is not yet finished).</li>
</ul>

<a name="client" class="anchor" href="#client">&nbsp;</a>

<h2>Clients</h2>

<p>MockServer has three client versions:</p>

<ul>
	<li>Java
		<ul>
			<li><strong>org.mockserver.client.server.MockServerClient</strong> - supports:
				<ul>
					<li>creating expectations</li>
					<li>clearing expectations (selectively)</li>
					<li>resetting (clearing all expectations)</li>
					<li>dumping all expectations to the log (for debugging)</li>
				</ul>
			</li>
			<li><strong>org.mockserver.client.proxy.ProxyClient</strong> - supports:
				<ul>
					<li>retrieving all recorded requests / responses as JSON or Expectation objects</li>
					<li>outputting to the log all recorded requests / responses as Expectations in JSON format</li>
					<li>outputting to the log all recorded requests / responses as Expectations in Java code format that can be pasted into test setup methods</li>
					<li>clearing recorded requests / responses (selectively)</li>
					<li>resetting (clearing all recorded requests / responses)</li>
				</ul>
			</li>
		</ul>
	</li>
	<li>JavaScript
		<ul>
			<li><strong>mockServerClient.js</strong> - supports:
				<ul>
					<li>creating expectations</li>
					<li>clearing expectations (selectively)</li>
					<li>resetting (clearing all expectations)</li>
					<li>dumping all expectations to the log (for debugging)</li>
				</ul>
			</li>
		</ul>
	</li>
</ul>
<p><strong>Note:</strong> It is not necessary to use the provided clients because the protocol for expectations is simple JSON (as explained below). However using the clients avoids the need to understand the underlying JSON protocol and provides a simple API.</p>

<a name="requirements" class="anchor" href="#requirements">&nbsp;</a>

<h2>Requirements</h2>

<ul>
	<li><strong>Java 7+</strong>&nbsp;&nbsp;&nbsp;because MockServer uses Jetty 9 (to increase reliability, simplicity and flexibility) which in turn requires Java 7</li>
</ul>

<a name="downloads" class="anchor" href="#versions">&nbsp;</a>

<h2>Downloads</h2>

<p>The simplest way to run and download MockServer is by using the fully stand alone web server embedded with all dependencies that mocks HTTP and HTTPS requests, as follows:</p>

<ol>
	<li><p>download <a href="http://search.maven.org/remotecontent?filepath=org/mock-server/mockserver-jetty/1.12/mockserver-jetty-1.12-jar-with-dependencies.jar">mockserver-jetty-1.12-jar-with-dependencies.jar</a> from Maven Central</p></li>
	<li>
		<code class="code inline">java -jar &lt;path to mockserver-jetty-1.12-jar-with-dependencies.jar&gt; -serverPort &lt;port&gt;</code>
	</li>
</ol>

<p class="sub_title">For more details on downloads see:</p>

<ul>
	<li><p>jar-with-dependencies / jar / war packages at <a href="#maven-central">MockServer on Maven Central</a>.</p></li>
	<li><p>Vert.X Modules at <a href="#vertx-registry">MockServer on Vert.X Module Registry</a>.</p></li>
	<li><p>source code at <a href="#github">MockServer on GitHub</a>.</p></li>
	<li><p>Running the MockServer at <a href="#22-starting-the-mockserver">Starting the MockServer</a>.</p></li>
</ul>

<a name="github" class="anchor" href="#github">&nbsp;</a>

<h2>GitHub</h2>

<p>The source control for MockServer is git which is hosted at GitHub <a href="https://github.com/jamesdbloom/mockserver">jamesdbloom/mockserver</a></p>

<p>GitHub is also used to track issues / bugs and manage pull-requests.</p>

<a name="maven-central" class="anchor" href="#maven-central">&nbsp;</a>

<h2>Maven Central</h2>

<p>Maven Central contains the following MockServer artifacts:</p>

<ul>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-maven-plugin">org.mock-server:mockserver-maven-plugin</a> - a set of maven plugins to start, stop and fork MockServer using maven</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-vertx">org.mock-server:mockserver-vertx</a> - a Vert.X module that mocks HTTP and HTTPS requests</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-jetty">org.mock-server:mockserver-jetty</a> - a web server that mocks HTTP and HTTPS requests (using Embedded Jetty)</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-jetty">org.mock-server:mockserver-jetty:jar-with-dependencies</a> - a fully stand alone web server embedded with all dependencies that mocks HTTP and HTTPS requests (using Embedded Jetty)</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-war">org.mock-server:mockserver-war</a> - a deployable WAR for mocking HTTP and HTTP requests (that runs on any JEE web server)</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-proxy">org.mock-server:mockserver-proxy</a> - an HTTP / HTTPS proxy that allows the recording and querying of requests and response</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-client">org.mock-server:mockserver-client</a> - a Java and JavaScript client to communicate with both the server and the proxy</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-core">org.mock-server:mockserver-core</a> - core classes shared by all versions</li>
	<li><a href="http://search.maven.org/#search%7Cga%7C1%7Cmockserver-integration-testing">org.mock-server:mockserver-integration-testing</a> - common classes used in integration testing different versions of MockServer</li>
</ul>

<p>In addition MockServer SNAPSHOT artifacts can also be found at <a href="https://oss.sonatype.org/index.html#nexus-search;quick%7Emockserver">https://oss.sonatype.org/index.html#nexus-search;quick~mockserver</a>.</p>

<a name="vertx-registry" class="anchor" href="#vertx-registry">&nbsp;</a>

<h2>Vert.X Module Registry</h2>

<p>Vert.X Module Registry contains the following artifacts:</p>

<ul>
	<li><a href="http://modulereg.vertx.io/">org.mock-server~mockserver-vertx~1.12</a> - a Vert.X module that mocks HTTP and HTTPS requests</li>
</ul>

<p>Vert.X Module Registry will shortly also have the following artifacts:</p>

<ul>
	<li><a href="http://modulereg.vertx.io/">org.mock-server~mockserver-vertx-proxy~1.12</a> - a Vert.X module that proxies HTTP and HTTPS allowing the recording and querying of requests and responses</li>
</ul>

<a name="how-to-use-mockserver" class="anchor" href="#how-to-use-mockserver">&nbsp;</a>

<h2>How to use MockServer</h2>

<p>To use the MockServer:</p>

<ol>
	<li>create mock responses</li>
	<li>setup mock expectations</li>
	<li>run test</li>
</ol>
<p>A system with service dependencies as follows:</p>

<p><a href="images/SystemInProduction.png" target="_blank"><img src="images/SystemInProduction.png" alt="System In Production" style="max-width:100%;"></a></p>

<p>Could be tested with MockServer, mocking the service dependencies, as follows:</p>

<p><a href="images/SystemUnderTest.png" target="_blank"><img src="images/SystemUnderTest.png" alt="Mocking service dependencies with MockServer" style="max-width:100%;"></a></p>

<a name="1-create-mock-response" class="anchor" href="#1-create-mock-response">&nbsp;</a>

<h3>1. create mock response</h3>

<p>The mock response can include any aspects of a HTTP request including: </p>

<ul>
	<li>
		<strong>response code</strong> i.e. 200, 302, 404, etc
	</li>
	<li>
		<strong>body</strong> - a string containing any content
	</li>
	<li>
		<strong>cookies</strong> - each with a name and with one or more values, more complex cookies can be modelled by using the a Set-Cookie header
	</li>
	<li>
		<strong>headers</strong> - each with a name and one or more values
	</li>
	<li>
		<strong>delay</strong> - including both the time unit (java.util.concurrent.TimeUnit) and value
	</li>
</ul>
<p><strong>Java</strong></p>

<p>To mock a response in Java use the org.mockserver.model.HttpResponse class which specifies the details of each HTTP response with a fluent API:</p>

<pre><code class="code"><span class="keyword">public class</span> HttpResponse {

    <span class="comment">/**
     * The status code to return, such as <span class="numeric_literal">200</span>, <span class="numeric_literal">404</span>, the status code specified
     * here will result in the default status message for this status code for
     * example for <span class="numeric_literal">200</span> the status message <span class="string_literal">"OK"</span> is used
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">statusCode</span> an integer such as <span class="numeric_literal">200</span> or <span class="numeric_literal">404</span>
     */</span>
    <span class="keyword">public</span> HttpResponse withStatusCode(Integer responseCode);

    <span class="comment">/**
     * The cookies to return as Set-Cookie headers as a list of Cookie objects
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">cookies</span> a list of Cookie objects
     */</span>
    <span class="keyword">public</span> HttpResponse withCookies(List&lt;Cookie&gt; cookies);
    <span class="comment">/**
     * The cookies to return as Set-Cookie headers as a varargs of Cookie objects
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">cookies</span> a varargs of Cookie objects
     */</span>
    <span class="keyword">public</span> HttpResponse withCookies(Cookie... cookies);

    <span class="comment">/**
     * The headers to return as a list of Header objects
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">headers</span> a list of Header objects
     */</span>
    <span class="keyword">public</span> HttpResponse withHeaders(List&lt;Header&gt; headers);
    <span class="comment">/**
     * The headers to return as a varargs of Header objects
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">headers</span> a varargs of Header objects
     */</span>
    <span class="keyword">public</span> HttpResponse withHeaders(Header... headers);

    <span class="comment">/**
     * The response body
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">body</span> a <span class="string_literal">"UTF-8"</span> string
     */</span>
    <span class="keyword">public</span> HttpResponse withBody(String body);

    <span class="comment">/**
     * The delay before responding with this request as a Delay object, for example <span class="keyword">new</span> Delay(TimeUnit.<span class="constant">SECONDS</span>, <span class="numeric_literal">3</span>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">delay</span> a Delay object, for example <span class="keyword">new</span> Delay(TimeUnit.<span class="constant">SECONDS</span>, <span class="numeric_literal">3</span>)
     */</span>
    <span class="keyword">public</span> HttpResponse withDelay(Delay delay);
}</code></pre>

<p>For example:</p>

<pre><code class="code">HttpResponse httpResponse =
        response()
                .withStatusCode(<span class="numeric_literal">200</span>)
                .withHeaders(
                        new Header(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>),
                        new Header(<span class="string_literal">"Cache-Control"</span>, <span class="string_literal">"public, max-age=86400"</span>)
                )
                .withBody(<span class="string_literal">"{ message: 'a simple json response' }"</span>);
</code></pre>

<p><strong>JavaScript</strong></p>

<p>A JavaScript client is provided called mockServerClient.js in the mockserver-client.jar maven dependency. This can also be found at mockservice/mockserver-client/src/main/javascript/mockServerClient.js in the git repository.</p>

<p>To mock a response in javascript use JSON to specify the details with the following format: </p>

<pre><code class="code"><span class="string_literal">"httpResponse"</span>: {
    <span class="string_literal">"statusCode"</span>: <span class="numeric_literal">200</span>,
    <span class="string_literal">"body"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"cookies"</span>: [],
    <span class="string_literal">"headers"</span>: [],
    <span class="string_literal">"delay"</span>: {
        <span class="string_literal">"timeUnit"</span>: <span class="string_literal">"MICROSECONDS"</span>,
        <span class="string_literal">"value"</span>: <span class="numeric_literal">0</span>
    }
}
</code></pre>

<p>Each cookie or header array entry has the following syntax:</p>

<pre><code class="code">{
    <span class="string_literal">"name"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"values"</span>: [<span class="string_literal">""</span>, <span class="string_literal">""</span>, ...]
}
</code></pre>

<p>The "timeUnit" value in "delay" can be:</p>

<pre><code class="code"><span class="string_literal">"NANOSECONDS"</span>
<span class="string_literal">"MICROSECONDS"</span>
<span class="string_literal">"MILLISECONDS"</span>
<span class="string_literal">"SECONDS"</span>
<span class="string_literal">"MINUTES"</span>
<span class="string_literal">"HOURS"</span>
<span class="string_literal">"DAYS"</span></code></pre>

<p>The same example as above would be:</p>

<pre><code class="code"><span class="string_literal">"httpResponse"</span>: {
    <span class="string_literal">"statusCode"</span>: <span class="numeric_literal">200</span>,
    <span class="string_literal">"body"</span>: <span class="string_literal">"{ message: 'a simple json response' }"</span>,
    <span class="string_literal">"headers"</span>: [
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"Content-Type"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"application/json; charset=utf-8"</span>]
        },
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"Cache-Control"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"public, max-age=86400"</span>]
        }
    ]
}</code></pre>

<a name="2-setup-mock-expectations" class="anchor" href="#2-setup-mock-expectations">&nbsp;</a>

<h3>2. Setup mock expectations</h3>

<a name="21-request-matcher" class="anchor" href="#21-request-matcher">&nbsp;</a>
<h4>2.1 Request matcher</h4>

<p>A mock expectation tells the MockServer how to response when receiving a request. To setup a mock expectation you need to provide the mock response (as described in 1. create mock response) and specify when and how often this response should be provided.</p>

<p>To specify when a response should be provided a request matcher must be provided. When the MockServer then receives a request that matches a matching request it will respond with the response specified in the mock expectation.</p>

<p>A request can be matched on the following:</p>

<ul>
	<li>
		<strong>method</strong> i.e. GET, POST, PUT, HEAD, etc
	</li>
	<li>
		<strong>path</strong> - a regular expression such as "/jamesdbloom/mockserver.*" or an exaxct match
	</li>
	<li>
		<strong>body</strong> - a regular expression or an exact match
	</li>
	<li>
		<strong>parameters</strong> - match of query parameters, not all query parameters need to be specified but those that are specified must match exactly, query parameters not specified will be ignored
	</li>
	<li>
		<strong>headers</strong> - not all headers need to be specified but those that are specified must match exactly, headers not specified will be ignored
	</li>
	<li>
		<strong>cookies</strong> - not all cookies need to be specified but those that are specified must match exactly, cookies not specified will be ignored
	</li>
</ul>
<p>For full details of the regular expression format supported for body and path see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">Java API for java.util.regex.Pattern</a></p>

<p><strong>Java</strong></p>

<p>To specify a request matcher in Java use the org.mockserver.model.HttpRequest class which specifies the details of each HTTP response with a fluent API:</p>

<pre><code class="code"><span class="keyword">public class</span> HttpRequest {

    <span class="comment">/**
     * The HTTP method to match on such as <span class="string_literal">"GET"</span> or <span class="string_literal">"POST"</span>
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">method</span> the HTTP method such as <span class="string_literal">"GET"</span> or <span class="string_literal">"POST"</span>
     */</span>
    <span class="keyword">public</span> HttpRequest withMethod(String method);

    <span class="comment">/**
     * The URL to match on such as <span class="string_literal">"http://localhost:9999/some_mocked_path"</span> regex values are also
     * supported such as <span class="string_literal">".*some_mocked_path"</span>, see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>
     * for full details of the supported regex syntax
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">url</span> the full URL such as <span class="string_literal">"http://localhost:9999/some_mocked_path"</span> or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withURL(String url);

    <span class="comment">/**
     * The path to match on such as <span class="string_literal">"/some_mocked_path"</span> any servlet context path is ignored for matching and should not be specified here
     * regex values are also supported such as <span class="string_literal">".*_path"</span>, see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>
     * for full details of the supported regex syntax
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">path</span> the path such as <span class="string_literal">"/some_mocked_path"</span> or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withPath(String path);

    <span class="comment">/**
     * The query string - this method only currently supports an exact match such as <span class="string_literal">"param=value&otherParam=otherValue"</span> or a regex match,
     * see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a> for full details of the supported regex syntax
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">queryString</span> the query string such as <span class="string_literal">"someParameter=someValue&someOtherParameter=someOtherValue"</span> or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withQueryString(String queryString);

    <span class="comment">/**
     * The parameters (in the query string or body) to match on as a list of Parameter objects where the values of each parameter can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">parameters</span> the list of Parameter objects where the values of each parameter can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withParameters(List&lt;Parameter&gt; parameters) {
    <span class="comment">/**
     * The parameters (in the query string or body) to match on as a varags Parameter objects where the values of each parameter can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">parameters</span> the varags Parameter objects where the values of each parameter can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withParameters(Parameter... parameters) {

    <span class="comment">/**
     * The body to match on such as <span class="string_literal">"{username: 'foo', password: 'bar'}"</span> or a regex (see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     * or an XPath expression which returns one or more values or evaluates to true (see <a href="http://saxon.sourceforge.net/saxon6.5.3/expressions.html">http://saxon.sourceforge.net/saxon6.5.3/expressions.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">body</span> the body on such as <span class="string_literal">"{username: 'foo', password: 'bar'}"</span>
     *             or a regex such as <span class="string_literal">"username[a-z]{4}"</span>
     *             or an XPath such as <span class="string_literal">"/element[key = 'some_key' and value = 'some_value']"</span>
     */</span>
    <span class="keyword">public</span> HttpRequest withBody(String body);

    <span class="comment">/**
     * The headers to match on as a list of Header objects where the values of each header can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">headers</span> the list of Header objects where the values of each header can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withHeaders(List&lt;Header&gt; headers);
    <span class="comment">/**
     * The headers to match on as a varags of Header objects  where the values of each header can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">headers</span> the varags of Header objects where the values of each header can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withHeaders(Header... headers);

    <span class="comment">/**
     * The cookies to match on as a list of Cookie objects  where the values of each cookie can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">cookies</span> the list of Cookie objects where the values of each cookie can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withCookies(List&lt;Cookie&gt; cookies);
    <span class="comment">/**
     * The cookies to match on as a varags Cookie objects where the values of each cookie can be either a string or a regex
     * (for more details of the supported regex syntax see <a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a>)
     *
     * <span class="javadoc_param_annotation">@param</span> <span class="javadoc_param_name">cookies</span> the varags Cookie objects where the values of each cookie can be either a string or a regex
     */</span>
    <span class="keyword">public</span> HttpRequest withCookies(Cookie... cookies);
}</code></pre>

<p>For example:</p>

<pre><code class="code">HttpRequest httpRequest =
        request()
                .withMethod(<span class="string_literal">"POST"</span>)
                .withPath(<span class="string_literal">"/login"</span>)
                .withBody(<span class="string_literal">"{username: 'foo', password: 'bar'}"</span>)
                .withCookies(
                        new Cookie(<span class="string_literal">"sessionId"</span>, <span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>)
                );</code></pre>

<p><strong>JavaScript</strong></p>

<p>A JavaScript client is provided called mockServerClient.js in the mockserver-client.jar maven dependency. This can also be found at mockservice/mockserver-client/src/main/javascript/mockServerClient.js in the git repository.</p>

<p>To specify a request matcher in javascript use JSON to specify the details with the following format: </p>

<pre><code class="code"><span class="string_literal">"httpRequest"</span>: {
    <span class="string_literal">"method"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"path"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"parameters"</span>: []
    <span class="string_literal">"body"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"cookies"</span>: [],
    <span class="string_literal">"headers"</span>: [],
}</code></pre>

<p>Each cookie or header array entry has the following syntax:</p>

<pre><code class="code">{
    <span class="string_literal">"name"</span>: <span class="string_literal">""</span>,
    <span class="string_literal">"values"</span>: [<span class="string_literal">""</span>, <span class="string_literal">""</span>, ...]
}</code></pre>

<p>The same example as above would be:</p>

<pre><code class="code"><span class="string_literal">"httpRequest"</span>: {
    <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
    <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
    <span class="string_literal">"body"</span>: <span class="string_literal">"{username: 'foo', password: 'bar'}"</span>,
    <span class="string_literal">"cookies"</span>: [
        {
            <span class="string_literal">"name"</span>: <span class="string_literal">"sessionId"</span>,
            <span class="string_literal">"values"</span>: [<span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>]
        }
    ],
    <span class="string_literal">"headers"</span>: [],
    <span class="string_literal">"parameters"</span>: []
}</code></pre>

<a name="22-starting-the-mockserver" class="anchor" href="#22-starting-the-mockserver">&nbsp;</a>
<h4>2.2 Starting the MockServer</h4>

<p>Before any mock expectation can be sent to the MockServer it must be started.</p>

<p>MockServer can be run in multiple ways:</p>

<ul>
	<li>via a Maven plugin (as part of a maven build),</li>
	<li>as a stand alone web server (using Embedded Jetty),</li>
	<li>as a Vert.X module,</li>
	<li>as a deployable WAR (to run on any JEE web server),</li>
	<li>as a NodeJS module (however this is currently been written and is not yet finished).</li>
</ul>
<p>MockServer also has two client versions:</p>

<ul>
	<li>one written in Java - org.mockserver.client.server.MockServerClient in mockserver-client</li>
	<li>and one written in JavaScript - mockServerClient.js in mockserver-client</li>
</ul>
<p><strong>Maven Plugin</strong></p>

<p>To run MockServer as part of your build add the following plugin to your pom.xml:</p>

<pre><code class="code xml">&lt;<span class="element">plugin</span>&gt;
    &lt;<span class="element">groupId</span>&gt;<span class="element_value">org.mock-server</span>&lt;/<span class="element">groupId</span>&gt;
    &lt;<span class="element">artifactId</span>&gt;<span class="element_value">mockserver-maven-plugin</span>&lt;/<span class="element">artifactId</span>&gt;
    &lt;<span class="element">version</span>&gt;<span class="element_value">1.12</span>&lt;/<span class="element">version</span>&gt;
    &lt;<span class="element">configuration</span>&gt;
        &lt;<span class="element">port</span>&gt;<span class="element_value">9090</span>&lt;/<span class="element">port</span>&gt;
        &lt;<span class="element">logLevel</span>&gt;<span class="element_value">TRACE</span>&lt;/<span class="element">logLevel</span>&gt;
    &lt;/<span class="element">configuration</span>&gt;
    &lt;<span class="element">executions</span>&gt;
        &lt;<span class="element">execution</span>&gt;
            &lt;<span class="element">id</span>&gt;<span class="element_value">initialize</span>&lt;/<span class="element">id</span>&gt;
            &lt;<span class="element">phase</span>&gt;<span class="element_value">initialize</span>&lt;/<span class="element">phase</span>&gt;
            &lt;<span class="element">goals</span>&gt;
                &lt;<span class="element">goal</span>&gt;<span class="element_value">start</span>&lt;/<span class="element">goal</span>&gt;
            &lt;/<span class="element">goals</span>&gt;
        &lt;/<span class="element">execution</span>&gt;
        &lt;<span class="element">execution</span>&gt;
            &lt;<span class="element">id</span>&gt;<span class="element_value">verify</span>&lt;/<span class="element">id</span>&gt;
            &lt;<span class="element">phase</span>&gt;<span class="element_value">verify</span>&lt;/<span class="element">phase</span>&gt;
            &lt;<span class="element">goals</span>&gt;
                &lt;<span class="element">goal</span>&gt;<span class="element_value">stop</span>&lt;/<span class="element">goal</span>&gt;
            &lt;/<span class="element">goals</span>&gt;
        &lt;/<span class="element">execution</span>&gt;
    &lt;/<span class="element">executions</span>&gt;
&lt;/<span class="element">plugin</span>&gt;</code></pre>

<p>This will start the MockServer during the <strong>initialize</strong> phase and will stop the MockServer during the <strong>verify</strong> phase. For more details about Maven build phases see:
	<a href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html</a>.</p>

<p>This ensures that any tests you run during you build in either the normal <strong>test</strong> phase or the <strong>integration-test</strong> phase can use the MockServer on the port specified.</p>

<p>It is also possible to run the MockServer as a forked JVM using the <strong>runForked</strong> and <strong>stopForked</strong> goals as follows:</p>

<pre><code class="code xml"> &lt;<span class="element">plugin</span>&gt;
     &lt;<span class="element">groupId</span>&gt;<span class="element_value">org.mock-server</span>&lt;/<span class="element">groupId</span>&gt;
     &lt;<span class="element">artifactId</span>&gt;<span class="element_value">mockserver-maven-plugin</span>&lt;/<span class="element">artifactId</span>&gt;
     &lt;<span class="element">version</span>&gt;<span class="element_value">1.12</span>&lt;/<span class="element">version</span>&gt;
     &lt;<span class="element">configuration</span>&gt;
         &lt;<span class="element">port</span>&gt;<span class="element_value">9090</span>&lt;/<span class="element">port</span>&gt;
         &lt;<span class="element">logLevel</span>&gt;<span class="element_value">TRACE</span>&lt;/<span class="element">logLevel</span>&gt;
         &lt;<span class="element">stopPort</span>&gt;<span class="element_value">9091</span>&lt;/<span class="element">stopPort</span>&gt;
         &lt;<span class="element">stopKey</span>&gt;<span class="element_value">STOP_KEY</span>&lt;/<span class="element">stopKey</span>&gt;
     &lt;/<span class="element">configuration</span>&gt;
     &lt;<span class="element">executions</span>&gt;
         &lt;<span class="element">execution</span>&gt;
             &lt;<span class="element">id</span>&gt;<span class="element_value">initialize</span>&lt;/<span class="element">id</span>&gt;
             &lt;<span class="element">phase</span>&gt;<span class="element_value">initialize</span>&lt;/<span class="element">phase</span>&gt;
             &lt;<span class="element">goals</span>&gt;
                 &lt;<span class="element">goal</span>&gt;<span class="element_value">runForked</span>&lt;/<span class="element">goal</span>&gt;
             &lt;/<span class="element">goals</span>&gt;
         &lt;/<span class="element">execution</span>&gt;
         &lt;<span class="element">execution</span>&gt;
             &lt;<span class="element">id</span>&gt;<span class="element_value">verify</span>&lt;/<span class="element">id</span>&gt;
             &lt;<span class="element">phase</span>&gt;<span class="element_value">verify</span>&lt;/<span class="element">phase</span>&gt;
             &lt;<span class="element">goals</span>&gt;
                 &lt;<span class="element">goal</span>&gt;<span class="element_value">stopForked</span>&lt;/<span class="element">goal</span>&gt;
             &lt;/<span class="element">goals</span>&gt;
         &lt;/<span class="element">execution</span>&gt;
     &lt;/<span class="element">executions</span>&gt;
 &lt;/<span class="element">plugin</span>&gt;
</code></pre>

<p>These goals can be used from the command line as well to start and stop MockServer, as follows:</p>

<p>To run the MockServer synchronously and block:</p>

<pre><code class="code">mvn mockserver:run</code></pre>

<p>To run the MockServer asynchronously as a forked JVM:</p>

<pre><code class="code">mvn mockserver:runForked</code></pre>

<p>To stop a forked instance of the MockServer running on the same machine:</p>

<pre><code class="code">mvn mockserver:stopForked</code></pre>

<p>The <strong>stopForked</strong> goal does assumes that the MockServer is running on the same physical machine as it uses 127.0.0.1 to communicate with the MockServer stop socket.</p>

<p>The Maven plugin has the following goals:</p>

<ul>
	<li>
		<strong>start</strong> - start MockServer, do not block, but stop when build ends
	</li>
	<li>
		<strong>stop</strong> - stop a MockServer started earlier as part of the current build
	</li>
	<li>
		<strong>run</strong> - run MockServer and block waiting for requests (timeout config if provided limits how long to block for)
	</li>
	<li>
		<strong>runForked</strong> - run MockServer as separate forked JVM, do not block, stay alive when build ends
	</li>
	<li>
		<strong>stopForked</strong> - stop a forked MockServer, previously started by a runForked goal
	</li>
</ul>
<p>The Maven plugin can be configured as follows:</p>

<ul>
	<li>
		<strong>port</strong> - The port to listen to incoming HTTP requests (required: false, default: 9090)
	</li>
	<li>
		<strong>timeout</strong> - How long to block waiting for MockServer, used by <strong>run</strong> goal, 0 means wait indefinitely (required: false, default: 0)
	</li>
	<li>
		<strong>logLevel</strong> - The logging level (required: false, default: WARN)
	</li>
	<li>
		<strong>stopPort</strong> - The port to listen to stop requests (required: false, default: port + 1)
	</li>
	<li>
		<strong>stopKey</strong> - The key to use for stop requests (required: false, default: STOP_KEY)
	</li>
	<li>
		<strong>skip</strong> - Prevent the plugin from running (required: false, default: false)
	</li>
</ul>
<p><strong>Embedded Jetty</strong></p>

<p>To run as Embedded Jetty run the following command:</p>

<ol>
	<li><p>download <a href="http://search.maven.org/remotecontent?filepath=org/mock-server/mockserver-jetty/1.12/mockserver-jetty-1.12-jar-with-dependencies.jar">mockserver-jetty-1.12-jar-with-dependencies.jar</a> from Maven Central</p></li>
	<li>
		<code class="code inline">java -jar &lt;path to mockserver-jetty-1.12-jar-with-dependencies.jar&gt; -serverPort &lt;port&gt;</code>
	</li>
</ol>

<p><strong>Vert.X</strong></p>

<p>First, you'll need to <a href="http://vertx.io/install.html">install Vert.x</a>.</p>

<p>To run as Vert.X module run the following command:</p>

<pre><code class="code">vertx install org.mock-server~mockserver-vertx~1.12
export VERTX_OPTS=<span class="string_literal">"-Dmockserver.port=9090 -Dmockserver.logLevel=TRACE"</span>
vertx runmod org.mock-server~mockserver-vertx~1.12</code></pre>

<p>Alternatively build from source and run the Vert.X module as a zip file:</p>

<pre><code class="code">git clone https://github.com/jamesdbloom/mockservice.git
cd mockserver
mvn clean package
export VERTX_OPTS=<span class="string_literal">"-Dmockserver.port=9090 -Dmockserver.logLevel=TRACE"</span>
vertx runzip mockserver-vertx/target/org.mock-server~mockserver-vertx~2.0-SNAPSHOT.zip</code></pre>

<p>The default port for the Vert.X MockServer module is <strong>8080</strong>. To run the MockServer on another port set / add an <strong>VERTX_OPTS</strong> environment variable specifying the system property <strong>mockserver.port</strong> as follows <strong>-Dmockserver.port=&lt;port&gt;</strong> for example:</p>

<pre><code class="code">export VERTX_OPTS=<span class="string_literal">"-Dmockserver.port=9090 -Dmockserver.logLevel=TRACE"</span></code></pre>

<p>It is also possible to update the default logging level by setting the system properties <strong>mockserver.logLevel</strong> as above.</p>

<p><strong>Web Archive (WAR)</strong></p>

<p>To run as a WAR deployed on any JEE web server:</p>

<ol>
	<li>download <a href="http://search.maven.org/remotecontent?filepath=org/mock-server/mockserver-war/1.12/mockserver-war-1.12.war">mockserver-war-1.12.war</a> from Maven Central</li>
	<li>deploy mockserver-war-1.12.war to web server</li>
</ol>

<p><strong>Build From Source</strong></p>

<p>Instead a build script in maven and a build script in gradle has been provided so the project can be built using either maven or gradle.</p>

<p>First clone the repository as follows:</p>

<pre><code class="code">git clone https://github.com/jamesdbloom/mockservice.git
cd mockserver</code></pre>

<p>Next build and run the project using either maven or gradle.</p>

<p><strong><em>Maven</em></strong></p>

<p>To build an executable jar containing all dependencies run the following command:</p>

<pre><code class="code">mvn clean package</code></pre>

<p>This will produce a jar file under the target directory called, as follows:</p>

<pre><code class="code">mockserver-jetty/target/mockserver-jetty-2.0-SNAPSHOT-jar-with-dependencies.jar</code></pre>

<p>Run the MockServer then using the executable jar as follows:</p>

<pre><code class="code">java -jar &lt;path to mockserver-jetty-2.0-SNAPSHOT-jar-with-dependencies.jar&gt; -serverPort &lt;port&gt;</code></pre>

<p>For example to run the MockServer on port 9999:</p>

<pre><code class="code">java -jar mockserver-jetty/target/mockserver-jetty-2.0-SNAPSHOT-jar-with-dependencies.jar -serverPort 9999</code></pre>

<p><strong><em>Gradle</em></strong></p>

<p>In gradle the project can be built and run in a single command as follows:</p>

<pre><code class="code">gradle run -Pport=&lt;port&gt;</code></pre>

<p>For example to run the MockServer on port 9999:</p>

<pre><code class="code">gradle run -Pport=9999</code></pre>

<a name="23-sending-mock-expectation" class="anchor" href="#23-sending-mock-expectation">&nbsp;</a>
<h4>2.3 Sending mock expectation</h4>

<p>To setup a mock expectation on the MockServer the mock response and request matcher must be sent to the MockServer. </p>

<p><strong>Java</strong></p>

<p>In Java MockServerClient can be used to send mock expectation to MockServer, as follows:</p>

<pre><code class="code">String hostname = <span class="string_literal">"localhost"</span>;
<span class="keyword">int</span> port = <span class="numeric_literal">9999</span>;

MockServerClient mockServerClient = <span class="keyword">new</span> MockServerClient(hostname, port);

HttpRequest httpRequest = <span class="keyword">new</span> HttpRequest()
        .withMethod(<span class="string_literal">"POST"</span>)
        .withPath(<span class="string_literal">"/login"</span>)
        .withBody(<span class="string_literal">"{username: 'foo', password: 'bar'}"</span>)
        .withCookies(
                new Cookie(<span class="string_literal">"sessionId"</span>, <span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>)
        );

HttpResponse httpResponse =
        <span class="keyword">new</span> HttpResponse()
                .withStatusCode(<span class="numeric_literal">200</span>)
                .withHeaders(
                        new Header(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>),
                        new Header(<span class="string_literal">"Cache-Control"</span>, <span class="string_literal">"public, max-age=86400"</span>)
                )
                .withBody(<span class="string_literal">"{ message: 'a simple json response' }"</span>)
                .withDelay(new Delay(TimeUnit.<span class="constant">SECONDS</span>, <span class="numeric_literal">1</span>));

mockServerClient.when(httpRequest, Times.unlimited()).respond(httpResponse);</code></pre>

<p>The org.mockserver.matchers.Times class is used to specify how many times you want the MockServer to match a request:</p>

<p>To create an instance to Times use one of the static factor methods:</p>

<pre><code class="code">Times.unlimited();
Times.once();
Times.exactly(<span class="keyword">int</span> count);</code></pre>

<p><strong>JavaScript</strong></p>

<p>In JavaScript a AJAX request can be used to send mock expectation to MockServer, as follows:</p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:9999"</span>, <span class="keyword">false</span>);
xmlHttpRequest.setRequestHeader(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>);
xmlHttpRequest.send(JSON.stringify({
    <span class="string_literal">"httpRequest"</span>: {
        <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
        <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
        <span class="string_literal">"cookies"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"sessionId"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"2By8LOhBmaW5nZXJwcmludCIlMDAzMW"</span>]
            }
        ]
    },
    <span class="string_literal">"httpResponse"</span>: {
        <span class="string_literal">"statusCode"</span>: <span class="numeric_literal">200</span>,
        <span class="string_literal">"body"</span>: JSON.stringify({ code: <span class="string_literal">"LOGIN_SUCCESS"</span>, message: <span class="string_literal">"login success"</span> }),
        <span class="string_literal">"headers"</span>: [
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Content-Type"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"application/json; charset=utf-8"</span>]
            },
            {
                <span class="string_literal">"name"</span>: <span class="string_literal">"Cache-Control"</span>,
                <span class="string_literal">"values"</span>: [<span class="string_literal">"public, max-age=86400"</span>]
            }
        ],
        <span class="string_literal">"delay"</span>: {
            <span class="string_literal">"timeUnit"</span>: <span class="string_literal">"MICROSECONDS"</span>,
            <span class="string_literal">"value"</span>: <span class="numeric_literal">0</span>
        }
    },
    <span class="string_literal">"times"</span>: {
        <span class="string_literal">"remainingTimes"</span>: <span class="numeric_literal">1</span>,
        <span class="string_literal">"unlimited"</span>: <span class="keyword">true</span>
    }
}));
</code></pre>

<a name="3-run-test" class="anchor" href="#3-run-test">&nbsp;</a>
<h4>3. Run test</h4>

<p>Once the mock expectations have been setup on the MockServer the test can be run. </p>

<a name="ensuring-tests-can-run-in-parallel" class="anchor" href="#ensuring-tests-can-run-in-parallel">&nbsp;</a>
<h4>Running Tests In Parallel</h4>

<p>To ensure all tests can run in parallel with completely isolated independent data it is important to include a value unique to each test for the request matcher. </p>

<p>For example the code above has a sessionId cookie in the request matcher. If each test generates a different value (i.e. a UUID) for the sessionId cookie then each test can receive completely independent response. Instead of a cookie value a query parameter or header (such as the Referer header) can also be used to ensure mock responses are unique to each test.</p>

<a name="clear--reset" class="anchor" href="#clear--reset">&nbsp;</a>

<h2>Clear &amp; Reset</h2>

<p>To clear <strong>ALL expectations</strong> from the MockServer (without restarting it) use the /reset endpoint, as follows:</p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:9999/reset"</span>, <span class="keyword">false</span>);
xmlHttpRequest.send();</code></pre>

<p>To clear <strong>only specific</strong> expectations from the MockServer use the /clear endpoint, as follows:</p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:9999/clear"</span>, <span class="keyword">false</span>);
xmlHttpRequest.setRequestHeader(<span class="string_literal">"Content-Type"</span>, <span class="string_literal">"application/json; charset=utf-8"</span>);
xmlHttpRequest.send(JSON.stringify({
    <span class="string_literal">"httpRequest"</span>: {
        <span class="string_literal">"method"</span>: <span class="string_literal">"POST"</span>,
        <span class="string_literal">"path"</span>: <span class="string_literal">"/login"</span>,
        <span class="string_literal">"cookies"</span>: [ ]
    }
}));</code></pre>

<p>The example above clears all expectations that will match incoming requests on the path <strong>/login</strong>.</p>

<a name="debugging-issues" class="anchor" href="#debugging-issues">&nbsp;</a>

<h2>Debugging Issues</h2>

<p>To simplify debugging the MockServer will dump all expectations as JSON to the log (as WARN level) when a request is made to the /dump endpoint, as follows:</p>

<pre><code class="code"><span class="keyword">var</span> xmlHttpRequest = <span class="keyword">new</span> XMLHttpRequest();
xmlHttpRequest.open(<span class="string_literal">"PUT"</span>, <span class="string_literal">"http://localhost:9999/dumpToLog"</span>, <span class="keyword">false</span>);
xmlHttpRequest.send();</code></pre>

<p>This will dump all expectations to the log using pretty-printed JSON.</p>

<p><br><a href="https://plus.google.com/110954472544793839756?rel=author">James D Bloom</a> - <a href="http://blog.jamesdbloom.com">Blog</a></p>
<span itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="James D Bloom">
    <meta itemprop="image" content="http://blog.jamesdbloom.com/jamesdbloom.jpg">
    <meta itemprop="givenName" content="James">
    <meta itemprop="familyName" content="Bloom">
    <meta itemprop="gender" content="male">
</span>
<meta itemprop="name" content="MockServer">
<meta itemprop="description" content="An API to easily mock any system or service you integrate with via HTTP or HTTPS from either Java or JavaScript.">
</div>
</div>
</div>
</body>
<script>
	(function (window, document) {

		var layout = document.getElementById('layout'),
				menu = document.getElementById('menu'),
				menuLink = document.getElementById('menuLink');

		function toggleClass(element, className) {
			var classes = element.className.split(/\s+/),
					length = classes.length,
					i = 0;

			for (; i < length; i++) {
				if (classes[i] === className) {
					classes.splice(i, 1);
					break;
				}
			}
			// The className is not found
			if (length === classes.length) {
				classes.push(className);
			}

			element.className = classes.join(' ');
		}

		menuLink.onclick = function (e) {
			var active = 'active';

			e.preventDefault();
			toggleClass(layout, active);
			toggleClass(menu, active);
			toggleClass(menuLink, active);
		};

	}(this, this.document));
</script>
<script>
	// google analytics
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-32687194-4']);
	_gaq.push(['_trackPageview']);
	(function () {
		var ga = document.createElement('script');
		ga.type = 'text/javascript';
		ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
		var s = document.getElementsByTagName('script')[0];
		s.parentNode.insertBefore(ga, s);
	})();
</script>
</html>